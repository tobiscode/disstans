

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Example 1: Long Valley Caldera Transient Motions &mdash; disstans 0.8 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="disstans" href="../disstans.html" />
    <link rel="prev" title="Examples" href="../examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> disstans
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_1.html">Tutorial 1: The first synthetic station</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#building-a-model-collection">Building a Model collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#creating-timeseries-objects">Creating Timeseries objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#fitting-the-models">Fitting the models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#plotting-the-fit-and-residuals">Plotting the fit and residuals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_2.html">Tutorial 2: Advanced Models and Fitting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#creating-more-complex-synthetic-data">Creating more complex synthetic data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#spline-models-for-transients">Spline models for transients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#building-a-network">Building a Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#fitting-an-entire-network">Fitting an entire network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#advanced-plotting">Advanced plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#repeat-with-l2-regularization">Repeat with L2 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#repeat-with-l1-regularization">Repeat with L1 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#adding-reweighting-iterations">Adding reweighting iterations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#comparing-specific-parameters">Comparing specific parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_3.html">Tutorial 3: Incorporating Spatial Coherence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#preparations">Preparations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#dreaming-up-a-network">Dreaming up a network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#fantasizing-data">Fantasizing data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#removing-the-common-mode-error">Removing the Common Mode Error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#fitting-the-data-using-reweighted-l1-regularization">Fitting the data using reweighted L1 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#fitting-the-data-using-a-spatially-aware-l1-reweighting">Fitting the data using a spatially-aware L1 reweighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#finding-unmodeled-jumps">Finding unmodeled jumps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#statistics-of-spatial-reweighting">Statistics of spatial reweighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#model-parameter-correlations">Model parameter correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#transient-visualization-with-worm-plots">Transient visualization with worm plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_4.html">Tutorial 4: The use and estimation of covariance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#making-a-noisy-network">Making a noisy network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#fitting-the-models-with-the-spatial-l0-solver">Fitting the models with the spatial L0 solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#quality-of-the-fits">Quality of the fits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#correlation-of-parameters">Correlation of parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#simple-linear-regression-with-restricted-spline-set">Simple linear regression with restricted spline set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#empirical-covariance-estimation">Empirical covariance estimation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example 1: Long Valley Caldera Transient Motions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparations">Preparations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#getting-data">Getting data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-the-network">Building the network</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cleaning-the-timeseries">Cleaning the timeseries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#outlier-and-cme-removal">Outlier and CME removal</a></li>
<li class="toctree-l4"><a class="reference internal" href="#first-pass-major-steps-and-noisy-periods">First pass: major steps and noisy periods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#second-pass-minor-catalog-based-steps">Second pass: minor, catalog-based steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-parameter-estimation">Model parameter estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comparison-of-secular-velocities">Comparison of secular velocities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-considerations">Final considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../disstans.html">disstans</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../disstans/compiled.html">Compiled</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../disstans/compiled.html#maskedmedfilt2d">maskedmedfilt2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/compiled.html#source-code">Source Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/earthquakes.html">Earthquakes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/models.html">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../disstans/models.html#model-parent-class">Model (Parent Class)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/models.html#model-collection">Model Collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/models.html#basic-models">Basic Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#arctangent">Arctangent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#exponential">Exponential</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#logarithmic">Logarithmic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#polynomial">Polynomial</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#step">Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#sinusoidal">Sinusoidal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/models.html#spline-models">Spline Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#bspline">BSpline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#ispline">ISpline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/models.html#splineset">SplineSet</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/network.html">Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/processing.html">Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../disstans/processing.html#unwrap-dict-and-ts">unwrap_dict_and_ts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/processing.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/processing.html#clean">clean</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/processing.html#common-mode">common_mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/processing.html#median">median</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/processing.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/processing.html#stepdetector">StepDetector</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/solvers.html">Solvers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../disstans/solvers.html#local-solver-functions">Local Solver Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#lasso-regression">lasso_regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#linear-regression">linear_regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#ridge-regression">ridge_regression</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/solvers.html#global-solver-classes">Global Solver Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#spatialsolver">SpatialSolver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/solvers.html#solution-object">Solution Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/solvers.html#reweighting-functions">Reweighting Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#reweightingfunction">ReweightingFunction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#inversereweighting">InverseReweighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#inversesquaredreweighting">InverseSquaredReweighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/solvers.html#logarithmicreweighting">LogarithmicReweighting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/station.html">Station</a></li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/timeseries.html">Timeseries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../disstans/timeseries.html#timeseries-parent-class">Timeseries (Parent Class)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/timeseries.html#specialized-classes">Specialized Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/timeseries.html#gipsytimeseries">GipsyTimeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/timeseries.html#unrtimeseries">UNRTimeseries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../disstans/tools.html">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../disstans/tools.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#parallelize">parallelize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#tvec-to-numpycol">tvec_to_numpycol</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#create-powerlaw-noise">create_powerlaw_noise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#parse-maintenance-table">parse_maintenance_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#weighted-median">weighted_median</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#download-unr-data">download_unr_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#parse-unr-steps">parse_unr_steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#get-cov-dims">get_cov_dims</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#make-cov-index-map">make_cov_index_map</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#get-cov-indices">get_cov_indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#full-cov-mat-to-columns">full_cov_mat_to_columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#block-permutation">block_permutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#cov2corr">cov2corr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../disstans/tools.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#rinexdataholding">RINEXDataHolding</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#timedelta">Timedelta</a></li>
<li class="toctree-l4"><a class="reference internal" href="../disstans/tools.html#click">Click</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">disstans</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Example 1: Long Valley Caldera Transient Motions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/examples/example_1.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-1-long-valley-caldera-transient-motions">
<h1>Example 1: Long Valley Caldera Transient Motions<a class="headerlink" href="#example-1-long-valley-caldera-transient-motions" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Long_Valley_Caldera">Long Valley Caldera</a> region in
California is a good example to show the capabilities of disstans of separating different signals
from geodetic timeseries. Most prominently, it exhibits transient motions associated with
magmatic activity, and includes sometimes large seasonal signals due to hydrological loading.
Because of the geophysical interest, it has been monitored with GNSS since the late 1990s.
Additionally, there are extensive catalogues detailing possible steps in the timeseries
that arise due to equipment changes or earthquakes, even though they appear to be incomplete
as we will see later. Today, the data is for example accessible through the
University of Nevada at Reno’s <a class="reference external" href="http://geodesy.unr.edu/">Nevada Geodetic Laboratory</a>.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#preparations" id="id3">Preparations</a></p>
<ul>
<li><p><a class="reference internal" href="#getting-data" id="id4">Getting data</a></p></li>
<li><p><a class="reference internal" href="#building-the-network" id="id5">Building the network</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#cleaning-the-timeseries" id="id6">Cleaning the timeseries</a></p>
<ul>
<li><p><a class="reference internal" href="#outlier-and-cme-removal" id="id7">Outlier and CME removal</a></p></li>
<li><p><a class="reference internal" href="#first-pass-major-steps-and-noisy-periods" id="id8">First pass: major steps and noisy periods</a></p></li>
<li><p><a class="reference internal" href="#second-pass-minor-catalog-based-steps" id="id9">Second pass: minor, catalog-based steps</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#model-parameter-estimation" id="id10">Model parameter estimation</a></p></li>
<li><p><a class="reference internal" href="#comparison-of-secular-velocities" id="id11">Comparison of secular velocities</a></p></li>
<li><p><a class="reference internal" href="#final-considerations" id="id12">Final considerations</a></p></li>
<li><p><a class="reference internal" href="#references" id="id13">References</a></p></li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the table of contents might suggest that this process is sequential,
each of the steps should be seen as an individual step that can be repeated
at different times. For example, if we first clean the timeseries to the best
of our abilities and then perform a fit, that fit might not be the best one.
Using the fit to get a better understanding of our noise, and how to model
signals, can in turn motivate another cleaning and fitting step.</p>
</div>
<div class="section" id="preparations">
<h2><a class="toc-backref" href="#id3">Preparations</a><a class="headerlink" href="#preparations" title="Permalink to this headline">¶</a></h2>
<p>Here are the imports we will need throughout the example:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">disstans</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
<p>We will also need two folders, one parent one, and one where the individual timeseries
files will be downloaded into:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># change these paths according to your system</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">main_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;proj_dir&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">main_dir</span> <span class="o">/</span> <span class="s2">&quot;data/gnss&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gnss_dir</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">/</span> <span class="s2">&quot;longvalley&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;../img&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended that you use an absolute path for <code class="docutils literal notranslate"><span class="pre">main_dir</span></code> since this path will
be part of the internal database we keep of the downloaded files, and executing this
example code then in a different folder will break the relative links.</p>
</div>
<p>To use multiple threads, we use the same code as in
<a class="reference internal" href="../tutorials/tutorial_3.html#preparations"><span class="std std-ref">Tutorial 3</span></a> (see there for changes you might
need to make on your own machine):</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">disstans</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="s2">&quot;general&quot;</span><span class="p">][</span><span class="s2">&quot;num_threads&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<div class="section" id="getting-data">
<h3><a class="toc-backref" href="#id4">Getting data</a><a class="headerlink" href="#getting-data" title="Permalink to this headline">¶</a></h3>
<p>disstans includes the <a class="reference internal" href="../disstans/tools.html#disstans.tools.download_unr_data" title="disstans.tools.download_unr_data"><code class="xref py py-func docutils literal notranslate"><span class="pre">download_unr_data()</span></code></a> function to automatically
download timeseries files from the UNR servers, the
<a class="reference internal" href="../disstans/timeseries.html#disstans.timeseries.UNRTimeseries" title="disstans.timeseries.UNRTimeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNRTimeseries</span></code></a> class to load the files, and the
<a class="reference internal" href="../disstans/tools.html#disstans.tools.parse_unr_steps" title="disstans.tools.parse_unr_steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">parse_unr_steps()</span></code></a> function to parse the steps file.
Feel free to check out their documentation for options used or not used here.</p>
<p>To download the timeseries, we first define the region of interest as a circle:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">center_lon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">118.884167</span>  <span class="c1"># [°]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">center_lat</span> <span class="o">=</span> <span class="mf">37.716667</span>  <span class="c1"># [°]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">radius</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># [km]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">station_bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">center_lon</span><span class="p">,</span> <span class="n">center_lat</span><span class="p">,</span> <span class="n">radius</span><span class="p">]</span>
</pre></div>
</div>
<p>We now download the data into the data directory, only using stations that have a minimum
number of observations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stations_df</span> <span class="o">=</span> <span class="n">disstans</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">download_unr_data</span><span class="p">(</span><span class="n">station_bbox</span><span class="p">,</span> <span class="n">gnss_dir</span><span class="p">,</span>
<span class="gp">... </span>                                             <span class="n">min_solutions</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">Making sure ...</span>
<span class="go">Downloading station list ...</span>
<span class="go">List of stations to download: ...</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>In the following, we need the dataframe returned by the download function.
The next time, we can therefore either run the same function again (which updates our local
copy of the data in the process), or if this would take too long each time, we can just
save the dataframe now, and load it the next time we use the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># save</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stations_df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gnss_dir</span><span class="si">}</span><span class="s2">/downloaded.pkl.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># load</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gnss_dir</span><span class="si">}</span><span class="s2">/downloaded.pkl.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="building-the-network">
<h3><a class="toc-backref" href="#id5">Building the network</a><a class="headerlink" href="#building-the-network" title="Permalink to this headline">¶</a></h3>
<p>First off, we instantiate a <a class="reference internal" href="../disstans/network.html#disstans.network.Network" title="disstans.network.Network"><code class="xref py py-class docutils literal notranslate"><span class="pre">Network</span></code></a> object:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span> <span class="o">=</span> <span class="n">disstans</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="s2">&quot;LVC&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We now use the <code class="docutils literal notranslate"><span class="pre">station_df</span></code> dataframe to loop over the paths of the downloaded files,
get the name and location of the stations, create
<a class="reference internal" href="../disstans/timeseries.html#disstans.timeseries.UNRTimeseries" title="disstans.timeseries.UNRTimeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">UNRTimeseries</span></code></a> objects, and if they meet some quality
thresholds (see <a class="reference internal" href="../disstans/timeseries.html#disstans.timeseries.Timeseries.reliability" title="disstans.timeseries.Timeseries.reliability"><code class="xref py py-attr docutils literal notranslate"><span class="pre">reliability</span></code></a> and
<a class="reference internal" href="../disstans/timeseries.html#disstans.timeseries.Timeseries.length" title="disstans.timeseries.Timeseries.length"><code class="xref py py-attr docutils literal notranslate"><span class="pre">length</span></code></a>), we create a
<a class="reference internal" href="../disstans/station.html#disstans.station.Station" title="disstans.station.Station"><code class="xref py py-class docutils literal notranslate"><span class="pre">Station</span></code></a> object, add the timeseries, and then add it to the network:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">stations_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="gp">... </span>    <span class="c1"># get name and location of station</span>
<span class="gp">... </span>    <span class="n">name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sta&quot;</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">loc</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;Lat(deg)&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Long(deg)&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Hgt(m)&quot;</span><span class="p">]]</span>
<span class="gp">... </span>    <span class="c1"># make a timeseries object to check availability metric</span>
<span class="gp">... </span>    <span class="n">tspath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gnss_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.tenv3&quot;</span>
<span class="gp">... </span>    <span class="n">loaded_ts</span> <span class="o">=</span> <span class="n">disstans</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">UNRTimeseries</span><span class="p">(</span><span class="n">tspath</span><span class="p">)</span>
<span class="gp">... </span>    <span class="c1"># make a station and add the timeseries only if two quality metrics are met</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="p">(</span><span class="n">loaded_ts</span><span class="o">.</span><span class="n">reliability</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">loaded_ts</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">)):</span>
<span class="gp">... </span>        <span class="n">net</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">disstans</span><span class="o">.</span><span class="n">Station</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">net</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">loaded_ts</span>
</pre></div>
</div>
<p>We can now use <a class="reference internal" href="../disstans/network.html#disstans.network.Network.gui" title="disstans.network.Network.gui"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gui()</span></code></a> to have a first look at the data
that was downloaded:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">gui</span><span class="p">(</span><span class="n">station</span><span class="o">=</span><span class="s2">&quot;CASA&quot;</span><span class="p">,</span> <span class="n">gui_kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wmts_show&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;wmts_alpha&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/example_1a_ts.png"><img alt="1a_ts" src="../_images/example_1a_ts.png" style="width: 49%;" /></a> <a class="reference internal" href="../_images/example_1a_map.png"><img alt="1a_map" src="../_images/example_1a_map.png" style="width: 49%;" /></a></p>
<p>Just clicking through the stations, a couple of things are relevant for us
going forward:</p>
<ul class="simple">
<li><p>The stations get denser spaced towards the center of the Long Valley Caldera, which will
help to isolate the smaller-scale transient motions.</p></li>
<li><p>West of the Sierra Nevada mountain range, the stations are less densely spaced, and are
strongly affected by seasonal signals.</p></li>
<li><p>Only a few stations have been operational since before the year 2000.</p></li>
<li><p>There is significant measurement noise all around, but some stations specifically (e.g.
P628, P723) also exhibit unphysical behavior in the winter times, possible related to
snowfall.</p></li>
</ul>
</div>
</div>
<div class="section" id="cleaning-the-timeseries">
<h2><a class="toc-backref" href="#id6">Cleaning the timeseries</a><a class="headerlink" href="#cleaning-the-timeseries" title="Permalink to this headline">¶</a></h2>
<p>In this step, we want to make sure that we will not use data with either a high noise floor,
or exhibiting behavior that we do not want to (or are not able) to model properly.
Both conditions would deteriorate our solution process later on, and while in general,
singular bad fits at individual stations can just be ignored afterwards, the fact that
we want to use a spatially-coherent solver, means that extremely bad fits at one station
can affect other stations as well.</p>
<div class="section" id="outlier-and-cme-removal">
<h3><a class="toc-backref" href="#id7">Outlier and CME removal</a><a class="headerlink" href="#outlier-and-cme-removal" title="Permalink to this headline">¶</a></h3>
<p>Outlier removal is done with the <a class="reference internal" href="../disstans/processing.html#disstans.processing.clean" title="disstans.processing.clean"><code class="xref py py-func docutils literal notranslate"><span class="pre">clean()</span></code></a> function using the raw
timeseries and a reference timeseries, accessed as a one-liner through
<a class="reference internal" href="../disstans/network.html#disstans.network.Network.call_func_no_return" title="disstans.network.Network.call_func_no_return"><code class="xref py py-meth docutils literal notranslate"><span class="pre">call_func_no_return()</span></code></a>.
The reference timeseries is created similarly using <a class="reference internal" href="../disstans/processing.html#disstans.processing.median" title="disstans.processing.median"><code class="xref py py-func docutils literal notranslate"><span class="pre">median()</span></code></a> and
<a class="reference internal" href="../disstans/network.html#disstans.network.Network.call_func_ts_return" title="disstans.network.Network.call_func_ts_return"><code class="xref py py-meth docutils literal notranslate"><span class="pre">call_func_ts_return()</span></code></a>.
The residual, which is needed for the Common Mode Error estimation, is quickly computed
at all stations with <a class="reference internal" href="../disstans/network.html#disstans.network.Network.math" title="disstans.network.Network.math"><code class="xref py py-meth docutils literal notranslate"><span class="pre">math()</span></code></a>.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># compute reference</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">call_func_ts_return</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">ts_in</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="n">ts_out</span><span class="o">=</span><span class="s2">&quot;raw_filt&quot;</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># remove outliers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">call_func_no_return</span><span class="p">(</span><span class="s2">&quot;clean&quot;</span><span class="p">,</span> <span class="n">ts_in</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;raw_filt&quot;</span><span class="p">,</span> <span class="n">ts_out</span><span class="o">=</span><span class="s2">&quot;raw_clean&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># get the residual for each station</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">math</span><span class="p">(</span><span class="s2">&quot;raw_filt_res&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_clean&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_filt&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># remove obsolete timeseries</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">remove_timeseries</span><span class="p">(</span><span class="s2">&quot;raw_clean&quot;</span><span class="p">,</span> <span class="s2">&quot;raw_filt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, similar to <a class="reference internal" href="../tutorials/tutorial_3.html#removing-the-common-mode-error"><span class="std std-ref">Tutorial 3</span></a>,
we estimate and remove the Common Mode Error:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># calculate common mode</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">call_netwide_func</span><span class="p">(</span><span class="s2">&quot;common_mode&quot;</span><span class="p">,</span> <span class="n">ts_in</span><span class="o">=</span><span class="s2">&quot;raw_filt_res&quot;</span><span class="p">,</span> <span class="n">ts_out</span><span class="o">=</span><span class="s2">&quot;common&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ica&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># now remove the common mode, call it the &quot;intermed&quot; timeseries,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">net</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">station</span><span class="o">.</span><span class="n">add_timeseries</span><span class="p">(</span><span class="s2">&quot;intermed&quot;</span><span class="p">,</span> <span class="n">station</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">station</span><span class="p">[</span><span class="s2">&quot;common&quot;</span><span class="p">],</span>
<span class="gp">... </span>                           <span class="n">override_data_cols</span><span class="o">=</span><span class="n">station</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data_cols</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">del</span> <span class="n">station</span><span class="p">[</span><span class="s2">&quot;common&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># clean again</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">call_func_ts_return</span><span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="n">ts_in</span><span class="o">=</span><span class="s2">&quot;intermed&quot;</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">ts_out</span><span class="o">=</span><span class="s2">&quot;intermed_filt&quot;</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">call_func_no_return</span><span class="p">(</span><span class="s2">&quot;clean&quot;</span><span class="p">,</span> <span class="n">ts_in</span><span class="o">=</span><span class="s2">&quot;intermed&quot;</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;intermed_filt&quot;</span><span class="p">,</span> <span class="n">ts_out</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">remove_timeseries</span><span class="p">(</span><span class="s2">&quot;intermed&quot;</span><span class="p">,</span> <span class="s2">&quot;intermed_filt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we assume that the cleaned timeseries has the same measurement uncertainties
than the original one, so we copy it over:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">copy_uncertainties</span><span class="p">(</span><span class="n">origin_ts</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="n">target_ts</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="first-pass-major-steps-and-noisy-periods">
<h3><a class="toc-backref" href="#id8">First pass: major steps and noisy periods</a><a class="headerlink" href="#first-pass-major-steps-and-noisy-periods" title="Permalink to this headline">¶</a></h3>
<p>Now that we have a cleaner timeseries to start from, we will try to identify as many
steps in the timeseries as possible, with the least amount of user interaction.
In order to do that, we first have to estimate and remove the dominant signal in the
timeseries: the seasonal (sinusoidal) and secular (linear plate motion) component.</p>
<p>This means we have to add models to the <code class="docutils literal notranslate"><span class="pre">'final'</span></code> timeseries at all stations.
In the <a class="reference internal" href="../tutorials.html"><span class="doc">Tutorials</span></a>, this was done individually for each station using
a loop and explicitly instantiating <a class="reference internal" href="../disstans/models.html#disstans.models.Model" title="disstans.models.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> objects, and then
adding them to the stations using <a class="reference internal" href="../disstans/station.html#disstans.station.Station.add_local_model_dict" title="disstans.station.Station.add_local_model_dict"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_local_model_dict()</span></code></a>.
This was both desired to illustrate the object-based nature of disstans, as well as
necessary since we needed direct access to the model objects anyway to read in
parameters and then evaluate the models to create synthetic timeseries.</p>
<p>Here, the models we’re using will change throughout the examples, and we don’t need
explicit access to the individual fitted parameters anytime soon, so we can skip all
of the work and instead just define the models using keyword dictionaries, taking
advantage of the <a class="reference internal" href="../disstans/network.html#disstans.network.Network.add_local_models" title="disstans.network.Network.add_local_models"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_local_models()</span></code></a> that will do all
of the instantiating and assigning for us:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Annual&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Sinusoidal&quot;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="mf">365.25</span><span class="p">,</span>
<span class="gp">... </span>                                 <span class="s2">&quot;t_reference&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01&quot;</span><span class="p">}},</span>
<span class="gp">... </span>          <span class="s2">&quot;Biannual&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Sinusoidal&quot;</span><span class="p">,</span>
<span class="gp">... </span>                       <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="mf">365.25</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                                   <span class="s2">&quot;t_reference&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01&quot;</span><span class="p">}},</span>
<span class="gp">... </span>          <span class="s2">&quot;Linear&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Polynomial&quot;</span><span class="p">,</span>
<span class="gp">... </span>                     <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>                                 <span class="s2">&quot;t_reference&quot;</span><span class="p">:</span> <span class="s2">&quot;2000-01-01&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                 <span class="s2">&quot;time_unit&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">add_local_models</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that we have added the models, we can perform the first model fitting
using basic linear least squares (<a class="reference internal" href="../disstans/solvers.html#disstans.solvers.linear_regression" title="disstans.solvers.linear_regression"><code class="xref py py-func docutils literal notranslate"><span class="pre">linear_regression()</span></code></a>)
in parallel through the <a class="reference internal" href="../disstans/network.html#disstans.network.Network.fitevalres" title="disstans.network.Network.fitevalres"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fitevalres()</span></code></a> method:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">fitevalres</span><span class="p">(</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;linear_regression&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">use_data_covariance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_description</span><span class="o">=</span><span class="s2">&quot;model_noreg&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">residual_description</span><span class="o">=</span><span class="s2">&quot;resid_noreg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We ignore the data covariance in this very first step for computation time
considerations. Again, we can use the <a class="reference internal" href="../disstans/network.html#disstans.network.Network.gui" title="disstans.network.Network.gui"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gui()</span></code></a>
method to have a look at the result (both the fit and the residuals).</p>
<p>By removing the major signals modeled, obvious transients and steps become
significantly more obvious - both for the human eye as well as any automated
step detector. In a fully manual framework, we would now click through the stations
one by one and writing down the dates on which to add steps that need to be estimated
and removed before we’re able to accurately estimate transients and smaller-magnitude
events.</p>
<p>disstans provides a simple step detector to avoid having to look at all stations and
all timespans, which instead tries to look for potential steps, and sorts them by
probability and station, such that the user can start from the most likely ones,
and then work their way down until all obvious steps (at least in this first stage)
are found. The included <a class="reference internal" href="../disstans/processing.html#disstans.processing.StepDetector" title="disstans.processing.StepDetector"><code class="xref py py-class docutils literal notranslate"><span class="pre">StepDetector</span></code></a> class is a simple
and imperfect one, but even more complicated ones (e.g. see <a class="reference internal" href="#gazeaux13" id="id1"><span>[gazeaux13]</span></a> for an
overview of manual and automated methods) fall short of human-in-the-loop techniques.
The class should therefore be viewed as only an aid to the user.</p>
<p>Let’s run it on the residual timeseries (see the method documentation for how it
works and keyword descriptions):</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stepdet</span> <span class="o">=</span> <span class="n">disstans</span><span class="o">.</span><span class="n">processing</span><span class="o">.</span><span class="n">StepDetector</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">61</span><span class="p">,</span> <span class="n">kernel_size_min</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">step_table</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stepdet</span><span class="o">.</span><span class="n">search_network</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;resid_noreg&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are two ways of inspecting the outputs now. First, we can of course just
print the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">step_table</span><span class="p">)</span>
<span class="go">     station       time  probability           var0        var1    varred</span>
<span class="go">2810    TILC 2008-07-27   430.576096   16394.763582   13.578651  0.999172</span>
<span class="go">558     LINC 1998-09-15   406.045023  433110.331209    6.933579  0.999984</span>
<span class="go">318     DOND 2016-04-20   226.769239     469.398525   10.982792  0.976602</span>
<span class="go">2835    WATC 2002-06-18   214.373441     414.922101   11.895713  0.971330</span>
<span class="go">2833    WATC 2002-04-04   197.731203     420.311464   15.830000  0.962337</span>
<span class="gp">... </span>     <span class="o">...</span>        <span class="o">...</span>          <span class="o">...</span>            <span class="o">...</span>         <span class="o">...</span>       <span class="o">...</span>
<span class="go">2465    P723 2014-04-15    20.018362       1.391209    0.965035  0.306333</span>
<span class="go">942     MWTP 2009-12-22    20.011034       1.954425    1.355882  0.306250</span>
<span class="go">1645    P636 2012-03-29    20.007697       4.041380    2.803860  0.306212</span>
<span class="go">2279    P651 2009-10-14    20.003098       0.767700    0.532661  0.306160</span>
<span class="go">813     MUSB 2001-03-02    20.002943     982.519810  681.713457  0.306158</span>

<span class="go">[2886 rows x 6 columns]</span>
</pre></div>
</div>
<p>To get an intuition what those numbers translate to in the timeseries, we can use
the second method: using the <a class="reference internal" href="../disstans/network.html#disstans.network.Network.gui" title="disstans.network.Network.gui"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gui()</span></code></a> with the
<code class="docutils literal notranslate"><span class="pre">mark_events</span></code> keyword option. If we supply it the entire table we just computed,
we will see that the low probabilities are most likely false detections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">gui</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">mark_events</span><span class="o">=</span><span class="n">step_table</span><span class="p">)</span>
</pre></div>
</div>
<p>So instead, for a first look at the major steps that we will need to model, let’s
restrict ourselves to a subset of th table where the variance reduction is more than 90%:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">step_table_above90</span> <span class="o">=</span> <span class="n">step_table</span><span class="p">[</span><span class="n">step_table</span><span class="p">[</span><span class="s2">&quot;varred&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">step_table_above90</span><span class="p">)</span>
<span class="go">     station       time  probability           var0        var1    varred</span>
<span class="go">2810    TILC 2008-07-27   430.576096   16394.763582   13.578651  0.999172</span>
<span class="go">558     LINC 1998-09-15   406.045023  433110.331209    6.933579  0.999984</span>
<span class="go">318     DOND 2016-04-20   226.769239     469.398525   10.982792  0.976602</span>
<span class="go">2835    WATC 2002-06-18   214.373441     414.922101   11.895713  0.971330</span>
<span class="go">2833    WATC 2002-04-04   197.731203     420.311464   15.830000  0.962337</span>
<span class="go">1372    P628 2017-01-08   167.892556    1898.938320  116.643148  0.938575</span>
<span class="go">1373    P628 2017-01-09   151.101501    1867.769472  151.083464  0.919110</span>
<span class="go">1644    P636 2011-09-15   145.391462      646.48758   57.425784  0.911173</span>
<span class="go">1388    P628 2019-04-28   144.992411    1410.977951  126.156042  0.910590</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">gui</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">mark_events</span><span class="o">=</span><span class="n">step_table_above90</span><span class="p">)</span>
</pre></div>
</div>
<p>The stations have two different behaviors. The first, simpler one, is just that of an
unmodeled step, e.g. at station TILC:</p>
<img alt="../_images/example_1b_TILC.png" src="../_images/example_1b_TILC.png" />
<p>Similar behavior can be found for LINC and DOND:</p>
<p><a class="reference internal" href="../_images/example_1b_LINC.png"><img alt="1b_LINC" src="../_images/example_1b_LINC.png" style="width: 49%;" /></a> <a class="reference internal" href="../_images/example_1b_DOND.png"><img alt="1b_DOND" src="../_images/example_1b_DOND.png" style="width: 49%;" /></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In general, the first thing to check with steps like these is to make sure they
aren’t related to a maintenance or earthquake event, which can be inferred from
publicly available catalogs. In these cases here, they are neither, and so we will
defer the part where we load those catalogs to improve our understanding of where
to put modeled steps to the next section.</p>
<p>Keep in mind that other data providers (e.g. UNAVCO) might have different position
timeseries for the same stations, and come with different site logs that might
be more complete.</p>
</div>
<p>We can add specific steps to those dates as follows:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;TILC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_local_model</span><span class="p">(</span><span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model_description</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model</span><span class="o">=</span><span class="n">disstans</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Step</span><span class="p">([</span><span class="s2">&quot;2008-07-26&quot;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;LINC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_local_model</span><span class="p">(</span><span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model_description</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model</span><span class="o">=</span><span class="n">disstans</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Step</span><span class="p">([</span><span class="s2">&quot;1998-09-13&quot;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;DOND&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_local_model</span><span class="p">(</span><span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model_description</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model</span><span class="o">=</span><span class="n">disstans</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Step</span><span class="p">([</span><span class="s2">&quot;2016-04-20&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Slightly different is WATC with a clear offset, but then also returning to its previous value:</p>
<img alt="../_images/example_1b_WATC.png" src="../_images/example_1b_WATC.png" />
<p>Where we can add the two steps as follows</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;WATC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_local_model</span><span class="p">(</span><span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model_description</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">,</span>
<span class="gp">... </span>                            <span class="n">model</span><span class="o">=</span><span class="n">disstans</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Step</span><span class="p">([</span><span class="s2">&quot;2002-04-04&quot;</span><span class="p">,</span> <span class="s2">&quot;2002-06-18&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>P628 and P636 exhibit a different behavior: Here, we can see that the
identified steps are related to transient motion. At P628 we can guess
that this appears seasonally, so snow cover on the antennas (also given
that the outliers are most strongly present in the Up component) is one
reasonable explanation.</p>
<p><a class="reference internal" href="../_images/example_1b_P628.png"><img alt="1b_P628" src="../_images/example_1b_P628.png" style="width: 49%;" /></a> <a class="reference internal" href="../_images/example_1b_P636.png"><img alt="1b_P636" src="../_images/example_1b_P636.png" style="width: 49%;" /></a></p>
<p>In our framework, we would think of this as noise, since it is not related
to any tectonic process. For P636, the most straightforward way to
avoid this noise affecting our fitting process is to eliminate the single
timespan this appears - towards the end of 2011. This is easily
done with the <a class="reference internal" href="../disstans/timeseries.html#disstans.timeseries.Timeseries.cut" title="disstans.timeseries.Timeseries.cut"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cut()</span></code></a> method:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;P636&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;2011-08-03&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;2011-09-14&quot;</span><span class="p">,</span> <span class="n">keep_inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>For P628, the noise is so strong that it affects the seasonal motion
estimate, and appears both pre-2012 as well as post-2017. We can
either define multiple timespans and mask out the data as we can do with
P636, or discard the entire timeseries (as published studies usually do).
While the former might be more desirable in an ideal world, we do not know
how big the influence still is during the seasons where the noise is less
apparent, so for this example, we will also go with simply discarding
the entire timeseries:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">net</span><span class="p">[</span><span class="s2">&quot;P628&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This is of course manual work - one way to reduce the number of lines of code would be to
determine a threshold by visual inspection (like the 90% variance reduction from above)
and then add steps to all the stations and times in the table. However, this will lead
to problems if we have cases like P636 and P628, where adding a step would be wrong.</p>
<p>After adding those major steps and removing noisy parts of the data, we are almost ready
to fit the models again. However, by clicking through the stations (and potentially
aided by the GUI’s <code class="docutils literal notranslate"><span class="pre">rms_on_map</span></code> option), we see that there are sometimes significant
longterm transients that aren’t captured by the purely linear and sinusoidal models.
To estimate the major trends as well (again to allow for a better step detecting process),
we add some longterm, unregularized spline models:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">longterm_transient_mdl</span> <span class="o">=</span> \
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;Longterm&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SplineSet&quot;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;degree&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="s2">&quot;t_center_start&quot;</span><span class="p">:</span> <span class="n">net</span><span class="p">[</span><span class="s2">&quot;CASA&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<span class="gp">... </span>                              <span class="s2">&quot;t_center_end&quot;</span><span class="p">:</span> <span class="n">net</span><span class="p">[</span><span class="s2">&quot;CA99&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<span class="gp">... </span>                              <span class="s2">&quot;list_num_knots&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">]}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">add_local_models</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">longterm_transient_mdl</span><span class="p">,</span> <span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Where we know that CASA has the earliest observation, and CA99 (as well as many other stations)
are active today and so will have the latest observation timestamp.
(See <a class="reference internal" href="../tutorials/tutorial_2.html#spline-models-for-transients"><span class="std std-ref">Tutorial 2</span></a> for an
introduction to splines in disstans.)</p>
<p>Now, let’s fit again:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">fitevalres</span><span class="p">(</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;linear_regression&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">use_data_covariance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_description</span><span class="o">=</span><span class="s2">&quot;model_noreg_2&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">residual_description</span><span class="o">=</span><span class="s2">&quot;resid_noreg_2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Before we open the GUI again to see the fitted models, we want to have a quantitative
understanding of how large the residuals are by looking at their root-mean-square (RMS):</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">resids_df</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">analyze_residuals</span><span class="p">(</span><span class="s2">&quot;resid_noreg_2&quot;</span><span class="p">,</span> <span class="n">rms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resids_df</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">resids_df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resids_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The default output is by component, so we took the vector norm of all components for each
station, and then sort the stations according to that. The first five entries are now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">resids_df</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">Station</span>
<span class="go">P723    19.295915</span>
<span class="go">CASA    13.522229</span>
<span class="go">MUSB    11.264618</span>
<span class="go">JNPR    10.026878</span>
<span class="go">KNOL     9.999189</span>
<span class="go">Name: total, dtype: float64</span>
</pre></div>
</div>
<p>Let’s open the GUI again, looking at these values on the map directly, and inspecting
the timeseries of those top-5 worst residuals, to identify any stations that are still
not being well fit by the models, and where we would need to either remove parts,
or add steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">gui</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">rms_on_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="s2">&quot;resid_noreg_2&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>P723 is a clear example of big, again probably snow-related events. We can either discard
the entire timeseries, or remove the noisy periods as before.</p>
<img alt="../_images/example_1c_P723.png" src="../_images/example_1c_P723.png" />
<p>MUSB and KNOL show similar behavior as well, but on a much smaller scale:</p>
<p><a class="reference internal" href="../_images/example_1c_MUSB.png"><img alt="1c_MUSB" src="../_images/example_1c_MUSB.png" style="width: 49%;" /></a> <a class="reference internal" href="../_images/example_1c_KNOL.png"><img alt="1c_KNOL" src="../_images/example_1c_KNOL.png" style="width: 49%;" /></a></p>
<p>We’ll remove those periods just as above (of course, one could write a nice loop for that,
especially if it were a larger network):</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;P723&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;2010-12-18&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;2011-04-18&quot;</span><span class="p">,</span> <span class="n">keep_inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;P723&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;2017-01-09&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;2017-05-24&quot;</span><span class="p">,</span> <span class="n">keep_inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;P723&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;2019-02-02&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;2019-04-02&quot;</span><span class="p">,</span> <span class="n">keep_inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;P723&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;2019-12-02&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;2020-04-02&quot;</span><span class="p">,</span> <span class="n">keep_inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;MUSB&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;1998-02-15&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;1998-04-19&quot;</span><span class="p">,</span> <span class="n">keep_inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;KNOL&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;2017-01-22&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;2017-03-16&quot;</span><span class="p">,</span> <span class="n">keep_inside</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>The other two stations show us that we’ve cleaned the data enough to move forward with the
actual estimation. At CASA, we now see that the most prominent signal is now a fast transient
that contributes to the currently still bad residual, and at JNPR, we see some outliers,
but no strong, coherent periods of noise offsets like before.</p>
<p><a class="reference internal" href="../_images/example_1c_CASA.png"><img alt="1c_CASA" src="../_images/example_1c_CASA.png" style="width: 49%;" /></a> <a class="reference internal" href="../_images/example_1c_JNPR.png"><img alt="1c_JNPR" src="../_images/example_1c_JNPR.png" style="width: 49%;" /></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CASA is at the exact same location as CA99 - on the map, they therefore appear on top
of each other, and it’s impossible to select CASA by clicking on it. We can use
the GUI’s <code class="docutils literal notranslate"><span class="pre">station</span></code> keyword though to pre-select a station.</p>
</div>
</div>
<div class="section" id="second-pass-minor-catalog-based-steps">
<h3><a class="toc-backref" href="#id9">Second pass: minor, catalog-based steps</a><a class="headerlink" href="#second-pass-minor-catalog-based-steps" title="Permalink to this headline">¶</a></h3>
<p>After removing major steps and noisy periods in the previous section, we will now do one
last unregularized fit to the data, which we will use to look for minor steps, this time
aided by UNR’s step file.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">fitevalres</span><span class="p">(</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;linear_regression&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">use_data_covariance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_description</span><span class="o">=</span><span class="s2">&quot;model_noreg_3&quot;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">residual_description</span><span class="o">=</span><span class="s2">&quot;resid_noreg_3&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We perform the regular step detection like above with the new residual timeseries:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">step_table</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stepdet</span><span class="o">.</span><span class="n">search_network</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;resid_noreg_3&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And then we use the <a class="reference internal" href="../disstans/tools.html#disstans.tools.parse_unr_steps" title="disstans.tools.parse_unr_steps"><code class="xref py py-func docutils literal notranslate"><span class="pre">parse_unr_steps()</span></code></a> function to download
(if <code class="docutils literal notranslate"><span class="pre">check_update=True</span></code>) or load (if already present) the catalog, parsing it into
two separate tables - one for the maintenance events, and one for potential earthquake events:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">unr_maint_table</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">unr_eq_table</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> \
<span class="gp">... </span>    <span class="n">disstans</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">parse_unr_steps</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2">/unr_steps.txt&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                 <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check_update</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>                                 <span class="n">only_stations</span><span class="o">=</span><span class="n">net</span><span class="o">.</span><span class="n">station_names</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">Maintenance descriptions:</span>
<span class="gp">...</span>
<span class="go">Number of Maintenance Events: ...</span>
<span class="go">Number of Earthquake-related Events: ...</span>
</pre></div>
</div>
<p>Then, we use the step detector object’s
<a class="reference internal" href="../disstans/processing.html#disstans.processing.StepDetector.search_catalog" title="disstans.processing.StepDetector.search_catalog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">search_catalog()</span></code></a> method to specifically test
the dates where events where recorded:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">maint_table</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stepdet</span><span class="o">.</span><span class="n">search_catalog</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;resid_noreg_3&quot;</span><span class="p">,</span> <span class="n">unr_maint_table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eq_table</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stepdet</span><span class="o">.</span><span class="n">search_catalog</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;resid_noreg_3&quot;</span><span class="p">,</span> <span class="n">unr_eq_table</span><span class="p">)</span>
</pre></div>
</div>
<p>(Of course, those dates will already have been checked by the general call to
<a class="reference internal" href="../disstans/processing.html#disstans.processing.StepDetector.search_network" title="disstans.processing.StepDetector.search_network"><code class="xref py py-meth docutils literal notranslate"><span class="pre">search_network()</span></code></a>, but if the step detector does
not see evidence for a step there given its input parameters, the probability of a
step being present at that date will not be included in the output table.)</p>
<p>The questions we want to answer now are:</p>
<ol class="arabic simple">
<li><p>Are there still large, unmodeled steps that are not included in the maintenance or
earthquake records?</p></li>
<li><p>Down to what probability (or variance reduction percentage) should we automatically
add entries in the records file to our stations? (Those can also differ between
maintenance and earthquakes.)</p></li>
</ol>
<p>To answer the first question, we can merge the dataframes, and drop the rows station-date
pairs that are present in both:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># merge the two catalog tables</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maint_or_eq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">maint_table</span><span class="p">[[</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]],</span>
<span class="gp">... </span>                       <span class="n">eq_table</span><span class="p">[[</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># merge with step_table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">merged_table</span> <span class="o">=</span> <span class="n">step_table</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">maint_or_eq</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">indicator</span><span class="o">=</span><span class="s2">&quot;merged&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># drop rows where the indicators are not only in step_table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">unknown_table</span> <span class="o">=</span> <span class="n">merged_table</span><span class="o">.</span> \
<span class="gp">... </span>    <span class="n">drop</span><span class="p">(</span><span class="n">merged_table</span><span class="p">[</span><span class="n">merged_table</span><span class="p">[</span><span class="s2">&quot;merged&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;left_only&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
<p>The station-time pairs that will be dropped are therefore those in
<code class="docutils literal notranslate"><span class="pre">merged_table[merged_table[&quot;merged&quot;]</span> <span class="pre">!=</span> <span class="pre">&quot;left_only&quot;]</span></code>, which are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">merged_table</span><span class="p">[</span><span class="n">merged_table</span><span class="p">[</span><span class="s2">&quot;merged&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;left_only&quot;</span><span class="p">])</span>
<span class="go">     station       time  probability       var0      var1    varred merged</span>
<span class="go">3       P469 2019-07-06    89.776302   2.702982  0.597512  0.778943   both</span>
<span class="go">14      P652 2020-05-15    64.012249   1.312560  0.442641  0.662765   both</span>
<span class="go">28      P627 2020-05-15    57.215089   2.348083  0.885195  0.623014   both</span>
<span class="go">38      P726 2019-07-06    52.866674   1.905756  0.771528  0.595159   both</span>
<span class="go">130     P627 2020-10-13    41.986505  16.479038  7.974044  0.516110   both</span>
<span class="go">196     P652 2019-07-06    38.507224   1.119373  0.573446  0.487708   both</span>
<span class="go">633     P651 2020-05-15    29.852991   1.533274  0.905215  0.409619   both</span>
<span class="go">636     P653 2019-07-06    29.824847   1.007099  0.594846  0.409347   both</span>
<span class="go">891     P650 2020-05-15    27.183701   0.882732  0.544460  0.383211   both</span>
<span class="go">1581    P311 2019-07-06    23.548194   0.464483  0.304081  0.345334   both</span>
<span class="go">2360    P651 2019-07-06    21.000839   0.955014  0.651877  0.317416   both</span>
<span class="go">2626    WATC 2019-07-06    20.285183   1.235032  0.852961  0.309361   both</span>
</pre></div>
</div>
<p>So only 12 entries in our <code class="docutils literal notranslate"><span class="pre">step_table</span></code> have an easy explanation, leaving the entries
in <code class="docutils literal notranslate"><span class="pre">unknown_table</span></code> either as false detections, or steps with unknown causes.</p>
<p>Because there are too many events in all three tables now to look at all of them
individually (already for this relatively small network), we need to start making
some thresholding choices, and add steps wherever the probability of a step is larger
than that. Because we have more confidence in steps recorded in one of the catalogs
than the ones only detected by the automatic step detector, that threshold can be chosen
differently. Here is where “geophysical intuition” now has to come into play, and we
have to accept that there are going to be false negatives and false positives.</p>
<p>To compare the catalogs quantitatively, we can plot how the probabilities of steps
are distributed within them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">unknown_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">unknown_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="gp">... </span>         <span class="n">unknown_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">maint_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span>
<span class="gp">... </span>         <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">maint_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
<span class="gp">... </span>         <span class="n">maint_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Maintenance&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">eq_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span>
<span class="gp">... </span>         <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">eq_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
<span class="gp">... </span>         <span class="n">eq_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Earthquake&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Normalized number of events&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/example_1d.png" src="../_images/example_1d.png" />
<p>We can see nice L-shaped curves for all three catalogs, but with different
probabilities at their inflection points. As a first guess of our thresholds,
we can e.g. choose 50 for the Unknown catalog, and 15 for the other two.
The reason we choose a probability above the turning point for the Unknown
catalog is that we want to minimize the impact of falsely adding a step where
none is there, but for the other two, where we know something <em>could</em> have
happened, we can pick the probability closer or even below the turning point.</p>
<p>To check our guess, we can use the GUI again, marking all earthquake steps
above 10:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">gui</span><span class="p">(</span><span class="n">timeseries</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">rms_on_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="s2">&quot;resid_noreg_3&quot;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="n">mark_events</span><span class="o">=</span><span class="n">eq_table</span><span class="p">[</span><span class="n">eq_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
<p>By clicking through the stations, we can see that 15 is a decent threshold.
Some steps that are below 15 should maybe be added, and some above 15 shouldn’t be,
but this is probably the best we can do in an automated way. We can proceed similarly
for the maintenance steps, and 15 also works well.</p>
<p>We can now use a loop now to add the model steps automatically:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">eq_steps_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">eq_table</span><span class="p">[</span><span class="n">eq_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">]</span>
<span class="gp">... </span>                     <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">)[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">steptimes</span> <span class="ow">in</span> <span class="n">eq_steps_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">net</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span><span class="o">.</span><span class="n">add_local_model_kwargs</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">model_kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Earthquake&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                      <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;steptimes&quot;</span><span class="p">:</span> <span class="n">steptimes</span><span class="p">}}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maint_steps_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">maint_table</span><span class="p">[</span><span class="n">maint_table</span><span class="p">[</span><span class="s2">&quot;probability&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">]</span>
<span class="gp">... </span>                        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">)[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">stat</span><span class="p">,</span> <span class="n">steptimes</span> <span class="ow">in</span> <span class="n">maint_steps_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">net</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span><span class="o">.</span><span class="n">add_local_model_kwargs</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">model_kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Maintenance&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Step&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                       <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;steptimes&quot;</span><span class="p">:</span> <span class="n">steptimes</span><span class="p">}}})</span>
</pre></div>
</div>
<p>Finally, checking for the unknown steps, we observe that some of them are actually
just a day or two off from maintenance steps which we will take care of, and most of
them, even above a probability of 60 or 70, are actually false or uncertain detections
we should probably skip. One exception is KRAC, where we have another step-and-reverse
event similar to the previous section. We could again just cut out the affected timespan,
but for purely example reasons, we’re instead going to add a model that will model
this temporary offset. We craft this particular model with a constant
<a class="reference internal" href="../disstans/models.html#disstans.models.Polynomial" title="disstans.models.Polynomial"><code class="xref py py-class docutils literal notranslate"><span class="pre">Polynomial</span></code></a> with a set start and end date, and setting it to zero
outside it’s active period. (We could also use a <a class="reference internal" href="../disstans/models.html#disstans.models.Step" title="disstans.models.Step"><code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code></a> model with
an end date, or write a new <a class="reference internal" href="../disstans/models.html#disstans.models.Model" title="disstans.models.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> class entirely.)</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;KRAC&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">add_local_model_kwargs</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">model_kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Offset&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Polynomial&quot;</span><span class="p">,</span>
<span class="gp">... </span>                              <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                                          <span class="s2">&quot;t_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2002-02-17&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                          <span class="s2">&quot;t_reference&quot;</span><span class="p">:</span> <span class="s2">&quot;2002-02-17&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                          <span class="s2">&quot;t_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2002-03-17&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                          <span class="s2">&quot;zero_before&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>                                          <span class="s2">&quot;zero_after&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}})</span>
</pre></div>
</div>
<p>We could loop back now and do a fourth unregularized linear regression solution,
checking again for too many or too few steps, which may be necessary for publication-grade
fitting quality. For the purposes of this example, we will move on, however.</p>
</div>
</div>
<div class="section" id="model-parameter-estimation">
<h2><a class="toc-backref" href="#id10">Model parameter estimation</a><a class="headerlink" href="#model-parameter-estimation" title="Permalink to this headline">¶</a></h2>
<p>Now we’re ready to do a full, spatially-coherent estimation of model parameters.
For that, we first remove the unregularized long-term transient model we added in
the previous section for a better step detection:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">net</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">stat</span><span class="o">.</span><span class="n">remove_local_models</span><span class="p">(</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="s2">&quot;Longterm&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>And we add a new Transient model with a larger range of timescales:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mdl_trans</span> <span class="o">=</span> \
<span class="gp">... </span>    <span class="p">{</span><span class="s2">&quot;Transient&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;SplineSet&quot;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;degree&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>                               <span class="s2">&quot;t_center_start&quot;</span><span class="p">:</span> <span class="n">net</span><span class="p">[</span><span class="s2">&quot;CASA&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
<span class="gp">... </span>                               <span class="s2">&quot;t_center_end&quot;</span><span class="p">:</span> <span class="n">net</span><span class="p">[</span><span class="s2">&quot;CA99&quot;</span><span class="p">][</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
<span class="gp">... </span>                               <span class="s2">&quot;list_num_knots&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]}}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">add_local_models</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="n">mdl_trans</span><span class="p">,</span> <span class="n">ts_description</span><span class="o">=</span><span class="s2">&quot;final&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Similar to
<a class="reference internal" href="../tutorials/tutorial_3.html#fitting-the-data-using-a-spatially-aware-l1-reweighting"><span class="std std-ref">Tutorial 3</span></a>
we now create the <a class="reference internal" href="../disstans/solvers.html#disstans.solvers.SpatialSolver" title="disstans.solvers.SpatialSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpatialSolver</span></code></a> object:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spatsol</span> <span class="o">=</span> <span class="n">disstans</span><span class="o">.</span><span class="n">solvers</span><span class="o">.</span><span class="n">SpatialSolver</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;final&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This time, we also specify our reweighting function explicitly:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rw_func</span> <span class="o">=</span> <span class="n">disstans</span><span class="o">.</span><span class="n">solvers</span><span class="o">.</span><span class="n">InverseReweighting</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we can run the estimation:</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spatsol</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">spatial_reweight_models</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Transient&quot;</span><span class="p">],</span>
<span class="gp">... </span>              <span class="n">spatial_reweight_iters</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">local_reweight_func</span><span class="o">=</span><span class="n">rw_func</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">use_data_covariance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">formal_covariance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">extended_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Calculating scale lengths</span>
<span class="go">Initial fit</span>
<span class="gp">...</span>
<span class="go">Done</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="n">output_description</span><span class="o">=</span><span class="s2">&quot;model_srw&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">math</span><span class="p">(</span><span class="s2">&quot;resid_srw&quot;</span><span class="p">,</span> <span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;model_srw&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We again see from the verbose progress output how the spatial sparsity is
well enforced, and the solver converges.</p>
<p>For a (relatively) quick first fit, we used <code class="docutils literal notranslate"><span class="pre">use_data_covariance=False</span></code>, but for a
final result, the data covariance should be taken into account. Using the GUI, we can
again get a first impression of the quality of the fit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">gui</span><span class="p">(</span><span class="n">station</span><span class="o">=</span><span class="s2">&quot;CASA&quot;</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">timeseries</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="s2">&quot;resid_srw&quot;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="n">rms_on_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="s2">&quot;resid_srw&quot;</span><span class="p">},</span>
<span class="gp">... </span>        <span class="n">scalogram_kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ts&quot;</span><span class="p">:</span> <span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Transient&quot;</span><span class="p">,</span> <span class="s2">&quot;cmaprange&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">})</span>
</pre></div>
</div>
<p><a class="reference internal" href="../_images/example_1e_ts.png"><img alt="1e_ts" src="../_images/example_1e_ts.png" style="width: 49%;" /></a> <a class="reference internal" href="../_images/example_1e_scalo.png"><img alt="1e_scalo" src="../_images/example_1e_scalo.png" style="width: 49%;" /></a></p>
<p>We can see that compared to the beginning of the example, where we had significant
unfitted transient signal in the timeseries at CASA and elsewhere, our fit now nicely
matches the trajectory (all the while respecting all the spatial signal that we have
taken advantage of). The scalograms also confirm that a sparse solution has been found.</p>
<p>To plot only the transient model fitted to the timeseries, we can also use the GUI
method with the keyword arguments
<code class="docutils literal notranslate"><span class="pre">sum_models=False,</span> <span class="pre">fit_list=[&quot;Transient&quot;],</span> <span class="pre">gui_kw_args={&quot;plot_sigmas&quot;:</span> <span class="pre">0}</span></code>,
which makes the transient periods very obvious:</p>
<img alt="../_images/example_1e_transient.png" src="../_images/example_1e_transient.png" />
<p>(We suppressed the plotting of the uncertainty since the formal variance for only a single
model has limited interpretability.)</p>
<p>To once again remind that there is always a trade-off between the transient spline signal
and the other models, let’s have a look at the correlation matrix for the CASA station:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="p">[</span><span class="s2">&quot;CASA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="s2">&quot;final&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot_covariance</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">plot_dir</span> <span class="o">/</span> <span class="s2">&quot;example_1e_corr.png&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                            <span class="n">plot_empty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_corr_coef</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/example_1e_corr.png" src="../_images/example_1e_corr.png" />
<p>We can also use the <a class="reference internal" href="../disstans/network.html#disstans.network.Network.wormplot" title="disstans.network.Network.wormplot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">wormplot()</span></code></a> method
(also see <a class="reference internal" href="../tutorials/tutorial_3.html#transient-visualization-with-worm-plots"><span class="std std-ref">Tutorial 3</span></a>)
to have a closer look at one of the transient periods at the center of the network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subset_stations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;RDOM&quot;</span><span class="p">,</span> <span class="s2">&quot;KRAC&quot;</span><span class="p">,</span> <span class="s2">&quot;SAWC&quot;</span><span class="p">,</span> <span class="s2">&quot;MWTP&quot;</span><span class="p">,</span> <span class="s2">&quot;CASA&quot;</span><span class="p">,</span> <span class="s2">&quot;CA99&quot;</span><span class="p">,</span> <span class="s2">&quot;P639&quot;</span><span class="p">,</span> <span class="s2">&quot;HOTK&quot;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="s2">&quot;P646&quot;</span><span class="p">,</span> <span class="s2">&quot;P638&quot;</span><span class="p">,</span> <span class="s2">&quot;DDMN&quot;</span><span class="p">,</span> <span class="s2">&quot;P634&quot;</span><span class="p">,</span> <span class="s2">&quot;KNOL&quot;</span><span class="p">,</span> <span class="s2">&quot;MINS&quot;</span><span class="p">,</span> <span class="s2">&quot;LINC&quot;</span><span class="p">,</span> <span class="s2">&quot;P630&quot;</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="s2">&quot;SHRC&quot;</span><span class="p">,</span> <span class="s2">&quot;P631&quot;</span><span class="p">,</span> <span class="s2">&quot;TILC&quot;</span><span class="p">,</span> <span class="s2">&quot;P642&quot;</span><span class="p">,</span> <span class="s2">&quot;BALD&quot;</span><span class="p">,</span> <span class="s2">&quot;P648&quot;</span><span class="p">,</span> <span class="s2">&quot;WATC&quot;</span><span class="p">,</span> <span class="s2">&quot;P632&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">net</span><span class="o">.</span><span class="n">wormplot</span><span class="p">(</span><span class="n">ts_description</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="s2">&quot;Transient&quot;</span><span class="p">),</span>
<span class="gp">... </span>             <span class="n">fname</span><span class="o">=</span><span class="n">plot_dir</span> <span class="o">/</span> <span class="s2">&quot;example_1f.png&quot;</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">fname_animation</span><span class="o">=</span><span class="n">plot_dir</span> <span class="o">/</span> <span class="s2">&quot;example_1f.mp4&quot;</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">t_min</span><span class="o">=</span><span class="s2">&quot;2011-07-01&quot;</span><span class="p">,</span> <span class="n">t_max</span><span class="o">=</span><span class="s2">&quot;2015-01-01&quot;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1e2</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">subset_stations</span><span class="o">=</span><span class="n">subset_stations</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">gui_kw_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;wmts_show&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;wmts_alpha&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
</pre></div>
</div>
<p>Which yields the following map:</p>
<img alt="../_images/example_1f.png" src="../_images/example_1f.png" />
<p>And animation:</p>

    <video   controls >
    <source src="../_static/example_1f.mp4" type="video/mp4">
    Video
    </video>
    <p>This is a relatively long timespan, so we can nicely see individual periods of coherent motion
of the network; the strongest one most notable being the radial outwards motion of the stations
from the center of the caldera. If we only wanted to show individual slow slip events, we could
identify the interesting periods from the timeseries, and then use mutliple wormplots with
shorter timespan.</p>
<p>On top of the largest transient motion, there are also smaller coherent motions visible in the
animation, e.g. at TILC or P642. A proper investigations into the causes for these fitted motions
(or whether they are “real” in the first place) would probably include a look at the non-sinusoidal,
long-term varying seasonal hydrological signal, as well as periods of increased seismicity, but
this is beyond the scope of this example.</p>
</div>
<div class="section" id="comparison-of-secular-velocities">
<h2><a class="toc-backref" href="#id11">Comparison of secular velocities</a><a class="headerlink" href="#comparison-of-secular-velocities" title="Permalink to this headline">¶</a></h2>
<p>Finally, as the last “sanity check” that our models are correctly disentangling secular motion from
other signals, let’s compare some of our estimated linear velocity vectors of the network stations
with the published MIDAS velocities in <a class="reference internal" href="#blewitt16" id="id2"><span>[blewitt16]</span></a> (everything in [m/a]):</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 15%" />
</colgroup>
<tbody>
<tr class="row-odd"><td rowspan="2"><p>Station</p></td>
<td colspan="3"><p>This example</p></td>
<td colspan="3"><p>MIDAS</p></td>
</tr>
<tr class="row-even"><td><p>East</p></td>
<td><p>North</p></td>
<td><p>Up</p></td>
<td><p>East</p></td>
<td><p>North</p></td>
<td><p>Up</p></td>
</tr>
<tr class="row-odd"><td><p>P308</p></td>
<td><p>-0.022067</p></td>
<td><p>-0.004061</p></td>
<td><p>-0.001997</p></td>
<td><p>-0.022473</p></td>
<td><p>-0.002419</p></td>
<td><p>+0.000957</p></td>
</tr>
<tr class="row-even"><td><p>DOND</p></td>
<td><p>-0.016032</p></td>
<td><p>-0.004899</p></td>
<td><p>-0.006095</p></td>
<td><p>-0.022462</p></td>
<td><p>-0.002837</p></td>
<td><p>+0.001112</p></td>
</tr>
<tr class="row-odd"><td><p>KRAC</p></td>
<td><p>-0.018828</p></td>
<td><p>-0.003319</p></td>
<td><p>+0.004523</p></td>
<td><p>-0.018233</p></td>
<td><p>-0.000377</p></td>
<td><p>+0.005676</p></td>
</tr>
<tr class="row-even"><td><p>CASA</p></td>
<td><p>-0.021165</p></td>
<td><p>-0.006569</p></td>
<td><p>-0.004468</p></td>
<td><p>-0.022905</p></td>
<td><p>-0.007212</p></td>
<td><p>+0.003864</p></td>
</tr>
<tr class="row-odd"><td><p>CA99</p></td>
<td><p>-0.024153</p></td>
<td><p>-0.006422</p></td>
<td><p>-0.000914</p></td>
<td><p>-0.023294</p></td>
<td><p>-0.006609</p></td>
<td><p>+0.004616</p></td>
</tr>
<tr class="row-even"><td><p>P724</p></td>
<td><p>-0.021189</p></td>
<td><p>-0.004674</p></td>
<td><p>-0.000033</p></td>
<td><p>-0.019328</p></td>
<td><p>-0.003772</p></td>
<td><p>+0.000314</p></td>
</tr>
<tr class="row-odd"><td><p>P469</p></td>
<td><p>-0.017439</p></td>
<td><p>-0.005994</p></td>
<td><p>+0.000604</p></td>
<td><p>-0.017806</p></td>
<td><p>-0.006302</p></td>
<td><p>+0.000086</p></td>
</tr>
<tr class="row-even"><td><p>P627</p></td>
<td><p>-0.014218</p></td>
<td><p>-0.005800</p></td>
<td><p>-0.000741</p></td>
<td><p>-0.016974</p></td>
<td><p>-0.005181</p></td>
<td><p>-0.000166</p></td>
</tr>
</tbody>
</table>
<p>In general, the two solutions are very similar, and differences might very well be because our
processing is not fully automatic and might therefore provide better (or worse) fits than MIDAS.
Again, a systematic comparison is beyond the scope of this example.</p>
</div>
<div class="section" id="final-considerations">
<h2><a class="toc-backref" href="#id12">Final considerations</a><a class="headerlink" href="#final-considerations" title="Permalink to this headline">¶</a></h2>
<p>Let’s conclude with two remarks:</p>
<ol class="arabic simple">
<li><p>The choice of the hyperparameters (e.g. starting <code class="docutils literal notranslate"><span class="pre">penalty</span></code>; the type and <code class="docutils literal notranslate"><span class="pre">eps</span></code>,
<code class="docutils literal notranslate"><span class="pre">scale</span></code> values for <a class="reference internal" href="../disstans/solvers.html#disstans.solvers.SpatialSolver" title="disstans.solvers.SpatialSolver"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpatialSolver</span></code></a>; the number and timescales
of the splines) are of course informed by me debugging and testing my code over and over
again. Different dataset, and possibly different questions wanted to be solved, will
likely warrant a systematic exploration of those. The
<a class="reference internal" href="../disstans/solvers.html#disstans.solvers.SpatialSolver.last_statistics" title="disstans.solvers.SpatialSolver.last_statistics"><code class="xref py py-attr docutils literal notranslate"><span class="pre">last_statistics</span></code></a> attribute can be helpful to track
the performance of different estimation hyperparameters.</p></li>
<li><p>For the best model fit, additional cleaning (outlier removal) and common mode estimation
steps might be useful.</p></li>
</ol>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id13">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="citation">
<dt class="label" id="gazeaux13"><span class="brackets"><a class="fn-backref" href="#id1">gazeaux13</a></span></dt>
<dd><p>Gazeaux, J., Williams, S., King, M., Bos, M., Dach, R., Deo, M., et al. (2013).
<em>Detecting offsets in GPS time series: First results from the detection of
offsets in GPS experiment</em>.
Journal of Geophysical Research: Solid Earth, 118(5), 2397–2407.
doi:<a class="reference external" href="https://doi.org/10.1002/jgrb.50152">10.1002/jgrb.50152</a></p>
</dd>
<dt class="label" id="blewitt16"><span class="brackets"><a class="fn-backref" href="#id2">blewitt16</a></span></dt>
<dd><p>Blewitt, G., Kreemer, C., Hammond, W. C., &amp; Gazeaux, J. (2016).
<em>MIDAS robust trend estimator for accurate GPS station velocities without step detection.</em>
Journal of Geophysical Research: Solid Earth, 121(3), 2054–2068.
doi:<a class="reference external" href="https://doi.org/10.1002/2015JB012552">10.1002/2015JB012552</a></p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../disstans.html" class="btn btn-neutral float-right" title="disstans" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Tobias Köhne.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>