<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>disstans.timeseries &mdash; DISSTANS 2.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=1413ff29"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=841abef3"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/copybutton.js?v=c8c824eb"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation &amp; Updates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#minimal-installation">Minimal installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#full-development-installation">Full development installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#updates">Updates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/tutorial_1.html">Tutorial 1: The first synthetic station</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_1.html#building-a-model-collection">Building a Model collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_1.html#creating-timeseries-objects">Creating Timeseries objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_1.html#fitting-the-models">Fitting the models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_1.html#plotting-the-fit-and-residuals">Plotting the fit and residuals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/tutorial_2.html">Tutorial 2: Advanced Models and Fitting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#creating-more-complex-synthetic-data">Creating more complex synthetic data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#spline-models-for-transients">Spline models for transients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#building-a-network">Building a Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#fitting-an-entire-network">Fitting an entire network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#advanced-plotting">Advanced plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#repeat-with-l2-regularization">Repeat with L2 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#repeat-with-l1-regularization">Repeat with L1 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#repeat-with-l0-regularization">Repeat with L0 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_2.html#comparing-specific-parameters">Comparing specific parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/tutorial_3.html">Tutorial 3: Incorporating Spatial Coherence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#preparations">Preparations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#dreaming-up-a-network">Dreaming up a network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#fantasizing-data">Fantasizing data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#removing-the-common-mode-error">Removing the Common Mode Error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#fitting-the-data-using-reweighted-l1-regularization">Fitting the data using reweighted L1 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#fitting-the-data-using-a-spatially-aware-l1-reweighting">Fitting the data using a spatially-aware L1 reweighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#finding-unmodeled-jumps">Finding unmodeled jumps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#statistics-of-spatial-reweighting">Statistics of spatial reweighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#model-parameter-correlations">Model parameter correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#transient-visualization-with-worm-plots">Transient visualization with worm plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_3.html#secular-velocity-comparisons">Secular velocity comparisons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/tutorial_4.html">Tutorial 4: The use and estimation of covariance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_4.html#making-a-noisy-network">Making a noisy network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_4.html#fitting-the-models-with-the-spatial-l0-solver">Fitting the models with the spatial L0 solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_4.html#quality-of-the-fits">Quality of the fits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_4.html#correlation-of-parameters">Correlation of parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_4.html#simple-linear-regression-with-restricted-spline-set">Simple linear regression with restricted spline set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_4.html#empirical-covariance-estimation">Empirical covariance estimation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials/tutorial_5.html">Tutorial 5: Signal Recovery at Low SNR</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_5.html#preparations">Preparations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_5.html#defining-the-variables-and-hyperparameter-space">Defining the variables and hyperparameter space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_5.html#running-test-cases">Running test cases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials/tutorial_5.html#results">Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_1.html">Example 1: Long Valley Caldera Transient Motions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#preparations">Preparations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../examples/example_1.html#getting-data">Getting data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../examples/example_1.html#building-the-network">Building the network</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#cleaning-the-timeseries">Cleaning the timeseries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../examples/example_1.html#outlier-and-cme-removal">Outlier and CME removal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../examples/example_1.html#first-pass-major-steps-and-noisy-periods">First pass: major steps and noisy periods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../examples/example_1.html#second-pass-minor-catalog-based-steps">Second pass: minor, catalog-based steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#model-parameter-estimation">Model parameter estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#modeled-horizontal-transient-motion">Modeled horizontal transient motion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#modeled-vertical-seasonal-motion">Modeled vertical seasonal motion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#comparison-of-secular-velocities">Comparison of secular velocities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#final-considerations">Final considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_1.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/example_2.html">Example 2: Long Valley Caldera Comparisons</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#preparations">Preparations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#homogenous-translation-rotation-and-strain">Homogenous translation, rotation, and strain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#rotation-about-an-euler-pole">Rotation about an Euler pole</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#comparison-of-different-methods">Comparison of different methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#loading-other-different-datasets">Loading other different datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#north-american-reference-frame">North American reference frame</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#estimate-euler-poles-for-datasets">Estimate Euler poles for datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#map-view-comparison-of-datasets">Map view comparison of datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#quantitative-comparison-of-datasets">Quantitative comparison of datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../examples/example_2.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html#how-do-i-know-which-penalties-to-use-in-subst">1. How do I know which penalties to use in <code class="xref py py-func docutils literal notranslate"><span class="pre">lasso_regression()</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">ReweightingFunction</span></code>?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../faq.html#how-can-i-save-my-network-object-to-save-time">2. How can I save my <code class="xref py py-class docutils literal notranslate"><span class="pre">Network</span></code> object to save time?</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../disstans.html">DISSTANS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/config.html">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/config.html#disstans.config.defaults"><code class="docutils literal notranslate"><span class="pre">config.defaults</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/earthquakes.html">Earthquakes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/earthquakes.html#disstans.earthquakes.okada_displacement"><code class="docutils literal notranslate"><span class="pre">okada_displacement()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/earthquakes.html#disstans.earthquakes.okada_prior"><code class="docutils literal notranslate"><span class="pre">okada_prior()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/earthquakes.html#disstans.earthquakes.empirical_prior"><code class="docutils literal notranslate"><span class="pre">empirical_prior()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/models.html">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/models.html#model-parent-class">Model (Parent Class)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#disstans.models.Model"><code class="docutils literal notranslate"><span class="pre">Model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#disstans.models.check_model_dict"><code class="docutils literal notranslate"><span class="pre">check_model_dict()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/models.html#model-collection">Model Collection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#disstans.models.ModelCollection"><code class="docutils literal notranslate"><span class="pre">ModelCollection</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/models.html#fit-collection">Fit Collection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#disstans.models.FitCollection"><code class="docutils literal notranslate"><span class="pre">FitCollection</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/models.html#basic-models">Basic Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#arctangent">Arctangent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#exponential">Exponential</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#hyperbolic-tangent">Hyperbolic Tangent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#logarithmic">Logarithmic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#polynomial">Polynomial</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#step">Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#sinusoid">Sinusoid</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/models.html#spline-models">Spline Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#bspline">BSpline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#ispline">ISpline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#basesplineset">BaseSplineSet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#splineset">SplineSet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#decayingsplineset">DecayingSplineSet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/models.html#ampphmodulatedsinusoid">AmpPhModulatedSinusoid</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/network.html">Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network"><code class="docutils literal notranslate"><span class="pre">Network</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.__contains__"><code class="docutils literal notranslate"><span class="pre">Network.__contains__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.__delitem__"><code class="docutils literal notranslate"><span class="pre">Network.__delitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.__getitem__"><code class="docutils literal notranslate"><span class="pre">Network.__getitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.__iter__"><code class="docutils literal notranslate"><span class="pre">Network.__iter__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.__len__"><code class="docutils literal notranslate"><span class="pre">Network.__len__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.__setitem__"><code class="docutils literal notranslate"><span class="pre">Network.__setitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.__str__"><code class="docutils literal notranslate"><span class="pre">Network.__str__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.add_default_local_models"><code class="docutils literal notranslate"><span class="pre">Network.add_default_local_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.add_local_models"><code class="docutils literal notranslate"><span class="pre">Network.add_local_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.add_station"><code class="docutils literal notranslate"><span class="pre">Network.add_station()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.add_unused_local_models"><code class="docutils literal notranslate"><span class="pre">Network.add_unused_local_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.ampphaseplot"><code class="docutils literal notranslate"><span class="pre">Network.ampphaseplot()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.analyze_residuals"><code class="docutils literal notranslate"><span class="pre">Network.analyze_residuals()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.call_func_no_return"><code class="docutils literal notranslate"><span class="pre">Network.call_func_no_return()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.call_func_ts_return"><code class="docutils literal notranslate"><span class="pre">Network.call_func_ts_return()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.call_netwide_func"><code class="docutils literal notranslate"><span class="pre">Network.call_netwide_func()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.copy_timeseries"><code class="docutils literal notranslate"><span class="pre">Network.copy_timeseries()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.copy_uncertainties"><code class="docutils literal notranslate"><span class="pre">Network.copy_uncertainties()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.create_station"><code class="docutils literal notranslate"><span class="pre">Network.create_station()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.decompose"><code class="docutils literal notranslate"><span class="pre">Network.decompose()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.default_local_models"><code class="docutils literal notranslate"><span class="pre">Network.default_local_models</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.default_location_path"><code class="docutils literal notranslate"><span class="pre">Network.default_location_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.euler_rot_field"><code class="docutils literal notranslate"><span class="pre">Network.euler_rot_field()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.evaluate"><code class="docutils literal notranslate"><span class="pre">Network.evaluate()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.export_network_ts"><code class="docutils literal notranslate"><span class="pre">Network.export_network_ts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.fit"><code class="docutils literal notranslate"><span class="pre">Network.fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.fitevalres"><code class="docutils literal notranslate"><span class="pre">Network.fitevalres()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.freeze"><code class="docutils literal notranslate"><span class="pre">Network.freeze()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.from_json"><code class="docutils literal notranslate"><span class="pre">Network.from_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.get_stations_with"><code class="docutils literal notranslate"><span class="pre">Network.get_stations_with()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.get_trend_change"><code class="docutils literal notranslate"><span class="pre">Network.get_trend_change()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.graphical_cme"><code class="docutils literal notranslate"><span class="pre">Network.graphical_cme()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.gui"><code class="docutils literal notranslate"><span class="pre">Network.gui()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.hom_velocity_field"><code class="docutils literal notranslate"><span class="pre">Network.hom_velocity_field()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.import_network_ts"><code class="docutils literal notranslate"><span class="pre">Network.import_network_ts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.load_maintenance_dict"><code class="docutils literal notranslate"><span class="pre">Network.load_maintenance_dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.math"><code class="docutils literal notranslate"><span class="pre">Network.math()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.mean_longitude"><code class="docutils literal notranslate"><span class="pre">Network.mean_longitude</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.name"><code class="docutils literal notranslate"><span class="pre">Network.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.num_stations"><code class="docutils literal notranslate"><span class="pre">Network.num_stations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.plot_availability"><code class="docutils literal notranslate"><span class="pre">Network.plot_availability()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.remove_models"><code class="docutils literal notranslate"><span class="pre">Network.remove_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.remove_station"><code class="docutils literal notranslate"><span class="pre">Network.remove_station()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.remove_timeseries"><code class="docutils literal notranslate"><span class="pre">Network.remove_timeseries()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.spatialfit"><code class="docutils literal notranslate"><span class="pre">Network.spatialfit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.station_locations"><code class="docutils literal notranslate"><span class="pre">Network.station_locations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.station_names"><code class="docutils literal notranslate"><span class="pre">Network.station_names</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.stations"><code class="docutils literal notranslate"><span class="pre">Network.stations</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.to_json"><code class="docutils literal notranslate"><span class="pre">Network.to_json()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.unfreeze"><code class="docutils literal notranslate"><span class="pre">Network.unfreeze()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.update_default_local_models"><code class="docutils literal notranslate"><span class="pre">Network.update_default_local_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/network.html#disstans.network.Network.wormplot"><code class="docutils literal notranslate"><span class="pre">Network.wormplot()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/processing.html">Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/processing.html#unwrap-dict-and-ts">unwrap_dict_and_ts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/processing.html#disstans.processing.unwrap_dict_and_ts"><code class="docutils literal notranslate"><span class="pre">unwrap_dict_and_ts()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/processing.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/processing.html#clean">clean</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/processing.html#decompose">decompose</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/processing.html#median">median</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/processing.html#midas">midas</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/processing.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/processing.html#stepdetector">StepDetector</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/solvers.html">Solvers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/solvers.html#solution-object">Solution Object</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#disstans.solvers.Solution"><code class="docutils literal notranslate"><span class="pre">Solution</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/solvers.html#solver-functions">Solver Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#lasso-regression">lasso_regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#linear-regression">linear_regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#ridge-regression">ridge_regression</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/solvers.html#reweighting-functions">Reweighting Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#reweightingfunction">ReweightingFunction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#inversereweighting">InverseReweighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#inversesquaredreweighting">InverseSquaredReweighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/solvers.html#logarithmicreweighting">LogarithmicReweighting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/station.html">Station</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station"><code class="docutils literal notranslate"><span class="pre">Station</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.__contains__"><code class="docutils literal notranslate"><span class="pre">Station.__contains__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.__delitem__"><code class="docutils literal notranslate"><span class="pre">Station.__delitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.__getitem__"><code class="docutils literal notranslate"><span class="pre">Station.__getitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.__iter__"><code class="docutils literal notranslate"><span class="pre">Station.__iter__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.__setitem__"><code class="docutils literal notranslate"><span class="pre">Station.__setitem__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.__str__"><code class="docutils literal notranslate"><span class="pre">Station.__str__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.add_fit"><code class="docutils literal notranslate"><span class="pre">Station.add_fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.add_local_model"><code class="docutils literal notranslate"><span class="pre">Station.add_local_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.add_local_model_dict"><code class="docutils literal notranslate"><span class="pre">Station.add_local_model_dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.add_local_model_kwargs"><code class="docutils literal notranslate"><span class="pre">Station.add_local_model_kwargs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.add_timeseries"><code class="docutils literal notranslate"><span class="pre">Station.add_timeseries()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.analyze_residuals"><code class="docutils literal notranslate"><span class="pre">Station.analyze_residuals()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.fits"><code class="docutils literal notranslate"><span class="pre">Station.fits</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.get_arch"><code class="docutils literal notranslate"><span class="pre">Station.get_arch()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.get_trend"><code class="docutils literal notranslate"><span class="pre">Station.get_trend()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.get_trend_change"><code class="docutils literal notranslate"><span class="pre">Station.get_trend_change()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.location"><code class="docutils literal notranslate"><span class="pre">Station.location</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.models"><code class="docutils literal notranslate"><span class="pre">Station.models</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.name"><code class="docutils literal notranslate"><span class="pre">Station.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.remove_fit"><code class="docutils literal notranslate"><span class="pre">Station.remove_fit()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.remove_local_models"><code class="docutils literal notranslate"><span class="pre">Station.remove_local_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.remove_timeseries"><code class="docutils literal notranslate"><span class="pre">Station.remove_timeseries()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.sum_fits"><code class="docutils literal notranslate"><span class="pre">Station.sum_fits()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.timeseries"><code class="docutils literal notranslate"><span class="pre">Station.timeseries</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.ts"><code class="docutils literal notranslate"><span class="pre">Station.ts</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/station.html#disstans.station.Station.unused_models"><code class="docutils literal notranslate"><span class="pre">Station.unused_models</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/timeseries.html">Timeseries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/timeseries.html#timeseries-parent-class">Timeseries (Parent Class)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries"><code class="docutils literal notranslate"><span class="pre">Timeseries</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/timeseries.html#specialized-classes">Specialized Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/timeseries.html#gipsytimeseries">GipsyTimeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/timeseries.html#gipsyxtimeseries">GipsyXTimeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/timeseries.html#unrtimeseries">UNRTimeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/timeseries.html#unrhighratetimeseries">UNRHighRateTimeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/timeseries.html#f5file">F5File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/timeseries.html#f5timeseries">F5Timeseries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../disstans/tools.html">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/tools.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#best-utmzone">best_utmzone</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#block-permutation">block_permutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#cov2corr">cov2corr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#create-powerlaw-noise">create_powerlaw_noise</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#date2decyear">date2decyear</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#download-unr-data">download_unr_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#estimate-euler-pole">estimate_euler_pole</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#eulerpole2rotvec">eulerpole2rotvec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#full-cov-mat-to-columns">full_cov_mat_to_columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#get-cov-dims">get_cov_dims</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#make-cov-index-map">make_cov_index_map</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#get-cov-indices">get_cov_indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#get-hom-vel-strain-rot">get_hom_vel_strain_rot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#parallelize">parallelize</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#parse-maintenance-table">parse_maintenance_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#parse-unr-steps">parse_unr_steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#r-ecef2enu">R_ecef2enu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#r-enu2ecef">R_enu2ecef</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#rotvec2eulerpole">rotvec2eulerpole</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#selectpair">selectpair</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#strain-rotation-invariants">strain_rotation_invariants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#tvec-to-numpycol">tvec_to_numpycol</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#weighted-median">weighted_median</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../disstans/tools.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#click">Click</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#rinexdataholding">RINEXDataHolding</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../disstans/tools.html#timedelta">Timedelta</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DISSTANS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">disstans.timeseries</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for disstans.timeseries</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains the :class:`~Timeseries` base class and other</span>
<span class="sd">formats included by default in DISSTANS.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">from</span> <span class="nn">.tools</span> <span class="kn">import</span> <span class="n">get_cov_dims</span><span class="p">,</span> <span class="n">make_cov_index_map</span><span class="p">,</span> <span class="n">get_cov_indices</span><span class="p">,</span> <span class="n">R_ecef2enu</span>


<div class="viewcode-block" id="Timeseries">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries">[docs]</a>
<span class="k">class</span> <span class="nc">Timeseries</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object that expands the functionality of a :class:`~pandas.DataFrame` object</span>
<span class="sd">    for better integration into DISSTANS. Apart from the data itself, it contains</span>
<span class="sd">    information about the source and units of the data. It also performs input</span>
<span class="sd">    checks and uses property setters/getters to ensure consistency.</span>

<span class="sd">    Also enables the ability to perform math on timeseries directly.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataframe</span>
<span class="sd">        The timeseries&#39; data as a DataFrame. The index should be time, whereas</span>
<span class="sd">        data columns can be both data and their uncertainties.</span>
<span class="sd">    src</span>
<span class="sd">        Source description.</span>
<span class="sd">    data_unit</span>
<span class="sd">        Data unit.</span>
<span class="sd">    data_cols</span>
<span class="sd">        List of strings with the names of the columns of ``dataframe`` that</span>
<span class="sd">        contain the data.</span>
<span class="sd">        The length corresponds to the number of components :attr:`~num_components`.</span>
<span class="sd">    var_cols</span>
<span class="sd">        List of strings with the names of the columns of ``dataframe`` that contain the</span>
<span class="sd">        data&#39;s variance.</span>
<span class="sd">        Must have the same length as ``data_cols``.</span>
<span class="sd">        ``None`` defaults to no data variance columns.</span>
<span class="sd">    cov_cols</span>
<span class="sd">        List of strings with the names of the columns of ``dataframe`` that contain</span>
<span class="sd">        the data&#39;s covariance.</span>
<span class="sd">        Must have length ``(num_components * (num_components - 1)) / 2``, where</span>
<span class="sd">        the order of the elements is determined by their row-by-row, sequential</span>
<span class="sd">        position in the covariance matrix (see Notes).</span>
<span class="sd">        ``None`` defaults to no covariance columns.</span>
<span class="sd">    remove_initial_offset</span>
<span class="sd">        If ``True``, the data timeseries will be shifted such that it starts at zero.</span>
<span class="sd">        The offset will be recorded in :class:`~Timeseries.offset` if it needs to be</span>
<span class="sd">        recovered.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    In terms of mapping the covariance matrix of observations into the format</span>
<span class="sd">    for the :class:`~Timeseries` class, consider this example for observations with</span>
<span class="sd">    three components:</span>

<span class="sd">    +-------------------+-------------------+-------------------+</span>
<span class="sd">    | ``var_cols[0]``   | ``cov_cols[0]``   | ``cov_cols[1]``   |</span>
<span class="sd">    +-------------------+-------------------+-------------------+</span>
<span class="sd">    | (symmetric)       | ``var_cols[1]``   | ``cov_cols[2]``   |</span>
<span class="sd">    +-------------------+-------------------+-------------------+</span>
<span class="sd">    | (symmetric)       | (symmetric)       | ``var_cols[2]``   |</span>
<span class="sd">    +-------------------+-------------------+-------------------+</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">dataframe</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                 <span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">data_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">data_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">var_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">cov_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">remove_initial_offset</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># input type checks</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">inferred_type</span> <span class="o">==</span> <span class="s2">&quot;datetime64&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_numeric_dtype</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">dtypes</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_unit</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dcol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="n">data_cols</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">dcol</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="n">data_cols</span><span class="p">])</span>
        <span class="c1"># duplicates check</span>
        <span class="n">index_duplicated</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">index_duplicated</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Input DataFrame cannot have duplicate indices, but found the &quot;</span>
                               <span class="s2">&quot;following duplicate timestamps:</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">dataframe</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">index_duplicated</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()))</span>
        <span class="c1"># save to private instance variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span> <span class="o">=</span> <span class="n">dataframe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="n">src</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_unit</span> <span class="o">=</span> <span class="n">data_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span> <span class="o">=</span> <span class="n">data_cols</span>
        <span class="c1"># additional checks for var_cols</span>
        <span class="k">if</span> <span class="n">var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">vcol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="n">var_cols</span><span class="p">]),</span> \
                <span class="sa">f</span><span class="s2">&quot;If not None, &#39;var_cols&#39; must be a list of strings, got </span><span class="si">{</span><span class="n">var_cols</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">vcol</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="n">var_cols</span><span class="p">]),</span> \
                <span class="s2">&quot;All entries in &#39;var_cols&#39; must be present in the dataframe.&quot;</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_cols</span><span class="p">),</span> \
                <span class="s2">&quot;If passing variance columns, &quot;</span> \
                <span class="s2">&quot;the list needs to have the same length as the data columns one.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="o">=</span> <span class="n">var_cols</span>
        <span class="c1"># additional checks for cov_cols</span>
        <span class="k">if</span> <span class="n">cov_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> \
                <span class="s2">&quot;In order to set covariances, the timeseries needs at least 2 components.&quot;</span>
            <span class="k">assert</span> <span class="n">cov_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
                <span class="s2">&quot;If setting covariances, the standard deviations must also be set.&quot;</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">ccol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">ccol</span> <span class="ow">in</span> <span class="n">cov_cols</span><span class="p">]),</span> \
                <span class="sa">f</span><span class="s2">&quot;If not None, &#39;cov_cols&#39; must be a list of strings, got </span><span class="si">{</span><span class="n">cov_cols</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">ccol</span> <span class="ow">in</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">ccol</span> <span class="ow">in</span> <span class="n">cov_cols</span><span class="p">]),</span> \
                <span class="s2">&quot;All entries in &#39;cov_cols&#39; must be present in the dataframe.&quot;</span>
            <span class="n">cov_dims</span> <span class="o">=</span> <span class="n">get_cov_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">)</span> <span class="o">==</span> <span class="n">cov_dims</span><span class="p">,</span> \
                <span class="s2">&quot;If passing covariance columns, the list needs to have the appropriate &quot;</span> \
                <span class="s2">&quot;length given the data columns length. &quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;Expected </span><span class="si">{</span><span class="n">cov_dims</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="c1"># everything should be alright, make index maps</span>
            <span class="n">index_map</span><span class="p">,</span> <span class="n">var_cov_map</span> <span class="o">=</span> <span class="n">make_cov_index_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span> <span class="o">=</span> <span class="n">index_map</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Matrix that contains the rolling indices of each matrix element used by</span>
<span class="sd">            :func:`~disstans.tools.get_cov_indices`.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_cov_map</span> <span class="o">=</span> <span class="n">var_cov_map</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Contains the column indices needed to create the full variance-covariance</span>
<span class="sd">            matrix for a single time.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="o">=</span> <span class="n">cov_cols</span>
        <span class="c1"># shift data to zero if desired</span>
        <span class="k">if</span> <span class="n">remove_initial_offset</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cols</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cols</span><span class="p">]</span> <span class="o">-=</span> <span class="n">offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Offset applied to the timeseries data such that it starts at zero. &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Timeseries.__str__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__str__">[docs]</a>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Special function that returns a readable summary of the timeseries.</span>
<span class="sd">        Accessed, for example, by Python&#39;s ``print()`` built-in function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Timeseries summary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Timeseries</span><span class="se">\n</span><span class="s2"> - Source: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">src</span><span class="si">}</span><span class="se">\n</span><span class="s2"> - Units: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">&quot;</span> \
               <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> - Shape: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="se">\n</span><span class="s2"> - Offset Removed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">&quot;</span> \
               <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> - Data: </span><span class="si">{</span><span class="p">[</span><span class="n">key</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">data_cols</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> - Variances: </span><span class="si">{</span><span class="p">[</span><span class="n">key</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">var_cols</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> - Covariances: </span><span class="si">{</span><span class="p">[</span><span class="n">key</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">cov_cols</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">info</span></div>


<div class="viewcode-block" id="Timeseries.__getitem__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__getitem__">[docs]</a>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience special function that provides a shorthand notation</span>
<span class="sd">        to access the timeseries&#39; columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        columns</span>
<span class="sd">            String or list of strings of the columns to return.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Returns the requested data as a Series (if a single column) or</span>
<span class="sd">            DataFrame (if multiple columns).</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        If ``ts`` is a :class:`~Timeseries` instance and ``columns`` a list</span>
<span class="sd">        of column names, the following two are equivalent::</span>

<span class="sd">            ts.df[columns]</span>
<span class="sd">            ts[ts_description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> \
           <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span>
           <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Error when accessing data in timeseries: &#39;column&#39; must be a &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;string or list of strings, given was </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Source information. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span>

    <span class="nd">@src</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">src</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_src</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_src</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New &#39;src&#39; attribute has to be a string, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">new_src</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="n">new_src</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Data unit. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_unit</span>

    <span class="nd">@data_unit</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_data_unit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;New &#39;data_unit&#39; attribute has to be a string, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">new_data_unit</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_unit</span> <span class="o">=</span> <span class="n">new_data_unit</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; List of the column names in :attr:`~df` that contain data. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span>

    <span class="nd">@data_cols</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_data_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dcol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="n">new_data_cols</span><span class="p">]),</span> \
            <span class="s2">&quot;New &#39;data_cols&#39; attribute must be a list of strings of the same length as the &quot;</span> \
            <span class="sa">f</span><span class="s2">&quot;current &#39;data_cols&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">), got </span><span class="si">{</span><span class="n">new_data_cols</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">old_col</span><span class="p">:</span> <span class="n">new_col</span> <span class="k">for</span> <span class="n">old_col</span><span class="p">,</span> <span class="n">new_col</span>
                                 <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">,</span> <span class="n">new_data_cols</span><span class="p">)},</span>
                        <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span> <span class="o">=</span> <span class="n">new_data_cols</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; List of the column names in :attr:`~df` that contain data variance. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span>

    <span class="nd">@var_cols</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">var_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_var_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s2">&quot;No variance columns found that can be renamed.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_var_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="nb">all</span><span class="p">([(</span><span class="n">vcol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vcol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="n">new_var_cols</span><span class="p">]),</span> \
            <span class="s2">&quot;New &#39;var_cols&#39; attribute must be a list of strings or Nones of the same length &quot;</span> \
            <span class="sa">f</span><span class="s2">&quot;as the current &#39;var_cols&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">), got </span><span class="si">{</span><span class="n">new_var_cols</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">for</span> <span class="n">ivcol</span><span class="p">,</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_var_cols</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">vcol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_var_cols</span><span class="p">[</span><span class="n">ivcol</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">[</span><span class="n">ivcol</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">old_col</span><span class="p">:</span> <span class="n">new_col</span> <span class="k">for</span> <span class="n">old_col</span><span class="p">,</span> <span class="n">new_col</span>
                                 <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">,</span> <span class="n">new_var_cols</span><span class="p">)},</span>
                        <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="o">=</span> <span class="n">new_var_cols</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cov_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; List of the column names in :attr:`~df` that contain data covariances. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span>

    <span class="nd">@cov_cols</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">cov_cols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_cov_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s2">&quot;No covariance columns found that can be renamed.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_cov_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="nb">all</span><span class="p">([(</span><span class="n">ccol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ccol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">ccol</span> <span class="ow">in</span> <span class="n">new_cov_cols</span><span class="p">]),</span> \
            <span class="s2">&quot;New &#39;cov_cols&#39; attribute must be a list of strings or Nones of the same length &quot;</span> \
            <span class="sa">f</span><span class="s2">&quot;as the current &#39;cov_cols&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">), got </span><span class="si">{</span><span class="n">new_cov_cols</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">for</span> <span class="n">iccol</span><span class="p">,</span> <span class="n">ccol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_cov_cols</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ccol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_cov_cols</span><span class="p">[</span><span class="n">iccol</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">[</span><span class="n">iccol</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">old_col</span><span class="p">:</span> <span class="n">new_col</span> <span class="k">for</span> <span class="n">old_col</span><span class="p">,</span> <span class="n">new_col</span>
                                 <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">,</span> <span class="n">new_cov_cols</span><span class="p">)},</span>
                        <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="o">=</span> <span class="n">new_cov_cols</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_components</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of data columns. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The entire timeseries&#39; DataFrame. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_observations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Number of observations (rows in :attr:`~df`). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; View of only the data columns in :attr:`~df`. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; View of only the data standard deviation columns in :attr:`~df`. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@sigmas</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sigmas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_sigma</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">new_sigma</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the variances from :attr:`~df`. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No variance columns present to return.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">]</span>

    <span class="nd">@vars</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_var</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No variance columns present to set.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_var</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">covs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Returns the covariances from :attr:`~df`. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No covariance columns present to return.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">]</span>

    <span class="nd">@covs</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">covs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_cov</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No covariance columns present to set.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cov</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">var_cov</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the variance as well as covariance columns from :attr:`~df`, to be indexed</span>
<span class="sd">        by :attr:`~var_cov_map` to yield the full variance-covariance matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No variance columns present to return.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No covariance columns present to return.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">]</span>

    <span class="nd">@var_cov</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">var_cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_var_cov</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cov_dims</span> <span class="o">=</span> <span class="n">get_cov_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">new_var_cov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span> <span class="o">+</span> <span class="n">cov_dims</span><span class="p">,</span> \
            <span class="s2">&quot;Setting &#39;var_cov&#39; requires a column for each variance (first half of array, &quot;</span> \
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="si">}</span><span class="s2">) and covariance (second half, </span><span class="si">{</span><span class="n">cov_dims</span><span class="si">}</span><span class="s2">).&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span> <span class="o">=</span> <span class="n">new_var_cov</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covs</span> <span class="o">=</span> <span class="n">new_var_cov</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">:]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Timestamps of the timeseries (index of :attr:`~df`). &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">index</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the shape tuple (similar to NumPy) of the timeseries, which is of shape</span>
<span class="sd">        :math:`(\text{n_observations},\text{n_components})`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_observations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the length of the timeseries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reliability</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the reliability (between 0 and 1) defined as the number of available</span>
<span class="sd">        observations divided by the the number of expected observations. The expected</span>
<span class="sd">        observations are calculated by taking the median timespan between observations,</span>
<span class="sd">        and then dividing the total time span by that timespan.</span>

<span class="sd">        (Essentially, this assumes that there are not any &quot;close-by&quot; observation, e.g.</span>
<span class="sd">        two observation for the same day but a different hour in a dataset of otherwise</span>
<span class="sd">        daily observations.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get median time difference</span>
        <span class="n">med_tdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
        <span class="c1"># expected observations</span>
        <span class="n">exp_obs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> <span class="n">med_tdiff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c1"># return ratio</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_observations</span> <span class="o">/</span> <span class="n">exp_obs</span>

<div class="viewcode-block" id="Timeseries.cov_at">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.cov_at">[docs]</a>
    <span class="k">def</span> <span class="nf">cov_at</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the covariance matrix of the timeseries at a given time or index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t</span>
<span class="sd">            A timestamp or timestamp-convertable string to return the covariance</span>
<span class="sd">            matrix for. Alternatively, an integer index.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            The full covariance matrix at time ``t``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># input checks</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
            <span class="s2">&quot;No variances available.&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> \
            <span class="sa">f</span><span class="s2">&quot;Time </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> not inside available timespan.&quot;</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span> \
            <span class="sa">f</span><span class="s2">&quot;No variances set at time </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="c1"># only variance is set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cov_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="c1"># full covariance matrix is available</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cov_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_cov</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_cov_map</span><span class="p">],</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cov_mat</span></div>


<div class="viewcode-block" id="Timeseries.check_covariances">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.check_covariances">[docs]</a>
    <span class="k">def</span> <span class="nf">check_covariances</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the covariance for each observation and determine whether it&#39;s</span>
<span class="sd">        positive-definite or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            An boolean array of size :math:`(\text{n_observations}, )` containing</span>
<span class="sd">            the result of the positive-definite check (``True`` if passed).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># quick check</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No covariances present to check.&quot;</span><span class="p">)</span>
        <span class="c1"># prepare input and output</span>
        <span class="n">varcov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_cov</span><span class="o">.</span><span class="n">values</span>
        <span class="n">is_posdef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_observations</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># loop over timestamps</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_observations</span><span class="p">):</span>
            <span class="c1"># test using Cholesky decomposition</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># skip all the checks that Timeseries.cov_at does</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">varcov</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_cov_map</span><span class="p">],</span>
                                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">)))</span>
                <span class="n">is_posdef</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># catch if not positive-definite</span>
            <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;Matrix is not positive definite&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">e</span>
        <span class="c1"># done</span>
        <span class="k">return</span> <span class="n">is_posdef</span></div>


<div class="viewcode-block" id="Timeseries.cut">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.cut">[docs]</a>
    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">t_min</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">t_max</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">i_min</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">i_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">keep_inside</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cut the timeseries to contain only data between certain times or indices.</span>
<span class="sd">        If both a minimum (maximum) timestamp or index is provided, the later (earlier,</span>
<span class="sd">        respectively) one is used (i.e., the more restrictive one).</span>
<span class="sd">        Also provides the reverse operation, i.e. only removing data between dates.</span>

<span class="sd">        This operation changes the timeseries in-place; if it should be done on a</span>
<span class="sd">        new timeseries, use :meth:`~copy` first.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t_min</span>
<span class="sd">            A timestamp or timestamp-convertable string of the earliest observation</span>
<span class="sd">            to keep.</span>
<span class="sd">        t_max</span>
<span class="sd">            A timestamp or timestamp-convertable string of the latest observation</span>
<span class="sd">            to keep.</span>
<span class="sd">        i_min</span>
<span class="sd">            The index of the earliest observation to keep.</span>
<span class="sd">        i_max</span>
<span class="sd">            The index of the latest observation to keep.</span>
<span class="sd">        keep_inside</span>
<span class="sd">            If ``True``, keeps data inside of the specified date range.</span>
<span class="sd">            If ``False``, keeps only data outside the specified date range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">any</span><span class="p">([</span><span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">i_min</span><span class="p">,</span> <span class="n">i_max</span><span class="p">]),</span> <span class="s2">&quot;No cutting operation defined.&quot;</span>
        <span class="c1"># convert to timestamps (if not already)</span>
        <span class="k">if</span> <span class="n">i_min</span><span class="p">:</span>
            <span class="n">t_from_i_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">i_min</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i_max</span><span class="p">:</span>
            <span class="n">t_from_i_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">i_max</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t_min</span><span class="p">:</span>
            <span class="n">t_min</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">t_min</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t_max</span><span class="p">:</span>
            <span class="n">t_max</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">t_max</span><span class="p">)</span>
        <span class="c1"># get more restrictive cutoffs</span>
        <span class="k">if</span> <span class="n">i_min</span> <span class="ow">and</span> <span class="n">t_min</span><span class="p">:</span>
            <span class="n">cut_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">t_from_i_min</span><span class="p">,</span> <span class="n">t_min</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">i_min</span> <span class="ow">or</span> <span class="n">t_min</span><span class="p">:</span>
            <span class="n">cut_min</span> <span class="o">=</span> <span class="n">t_min</span> <span class="k">if</span> <span class="n">t_min</span> <span class="k">else</span> <span class="n">t_from_i_min</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cut_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i_max</span> <span class="ow">and</span> <span class="n">t_max</span><span class="p">:</span>
            <span class="n">cut_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">t_from_i_max</span><span class="p">,</span> <span class="n">t_max</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">i_max</span> <span class="ow">or</span> <span class="n">t_max</span><span class="p">:</span>
            <span class="n">cut_max</span> <span class="o">=</span> <span class="n">t_max</span> <span class="k">if</span> <span class="n">t_max</span> <span class="k">else</span> <span class="n">t_from_i_max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cut_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># cut the dataframe directly</span>
        <span class="k">if</span> <span class="n">keep_inside</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;=</span> <span class="n">cut_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="n">cut_max</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">cut_min</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="n">cut_max</span><span class="p">)]</span></div>


<div class="viewcode-block" id="Timeseries.add_uncertainties">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.add_uncertainties">[docs]</a>
    <span class="k">def</span> <span class="nf">add_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">timeseries</span><span class="p">:</span> <span class="n">Timeseries</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">var_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">var_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">cov_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">cov_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add variance and covariance data and column names to the timeseries.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timeseries</span>
<span class="sd">            Another timeseries object that contains uncertainty information.</span>
<span class="sd">            If set, the function will ignore the rest of the arguments.</span>
<span class="sd">        var_data</span>
<span class="sd">            New data variance.</span>
<span class="sd">        var_cols</span>
<span class="sd">            List of variance column names.</span>
<span class="sd">        cov_data</span>
<span class="sd">            New data covariance.</span>
<span class="sd">            Setting this but not ``var_data`` requires there to already be data variance.</span>
<span class="sd">        cov_cols</span>
<span class="sd">            List of covariance column names.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If ``ts`` is a :class:`~disstans.timeseries.Timeseries` instance, just using::</span>

<span class="sd">            ts.vars = new_variance</span>
<span class="sd">            ts.covs = new_covariance</span>

<span class="sd">        will only work when the respective columns already exist in the dataframe.</span>
<span class="sd">        (This is the same behavior for renaming variance columns that do not exist.)</span>
<span class="sd">        If they do not exist, the calls will results in an error because no column names exist,</span>
<span class="sd">        in an effort to make the inner workings more transparent and rigorous.</span>

<span class="sd">        This function allows to override the default behavior, and can also generate column</span>
<span class="sd">        names by itself if none are specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if input is a Timeseries, override rest of input arguments</span>
        <span class="k">if</span> <span class="n">timeseries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot use uncertainty data: &quot;</span>
                                <span class="s2">&quot;&#39;timeseries&#39; is not a Timeseries object.&quot;</span><span class="p">)</span>
            <span class="c1"># get variance data and description</span>
            <span class="k">if</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">var_data</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">vars</span><span class="p">[</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">var_cols</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">var_cols</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">var_cols</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># get covariance data and description</span>
            <span class="k">if</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">cov_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cov_data</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">covs</span><span class="p">[</span><span class="n">timeseries</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
                <span class="n">cov_cols</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">cov_cols</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cov_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">cov_cols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># add variance</span>
        <span class="k">if</span> <span class="n">var_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">var_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> \
                   <span class="s2">&quot;&#39;var_data&#39; must be a NumPy array of the same shape as the data &quot;</span> \
                   <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, got &quot;</span> \
                   <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_data</span><span class="o">.</span><span class="n">shape</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">var_data</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">var_data</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">if</span> <span class="n">var_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">var_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dcol</span> <span class="o">+</span> <span class="s2">&quot;_sigma&quot;</span> <span class="k">for</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_cols</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">var_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_cols</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span> <span class="ow">and</span>
                        <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">vcol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="n">var_cols</span><span class="p">])),</span> \
                       <span class="s2">&quot;New &#39;var_cols&#39; attribute must be a list of strings of the same length &quot;</span> \
                       <span class="sa">f</span><span class="s2">&quot;as the current &#39;data_cols&#39; (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">), got </span><span class="si">{</span><span class="n">var_cols</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">for</span> <span class="n">ivcol</span><span class="p">,</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_cols</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">vcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">var_data</span><span class="p">[:,</span> <span class="n">ivcol</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="o">=</span> <span class="n">var_cols</span>
        <span class="c1"># add covariance, check for variance</span>
        <span class="k">if</span> <span class="n">cov_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> \
                <span class="s2">&quot;Cannot set covariance data without first adding variance data.&quot;</span>
            <span class="n">cov_dims</span> <span class="o">=</span> <span class="n">get_cov_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cov_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="n">cov_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_observations</span>
                    <span class="ow">and</span> <span class="n">cov_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">cov_dims</span><span class="p">),</span> \
                <span class="s2">&quot;&#39;cov_data&#39; must be a NumPy array of the same length as the data &quot;</span> \
                <span class="s2">&quot;and width corresponding to all possible covariances. Expected shape &quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_observations</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">cov_dims</span><span class="si">}</span><span class="s2">), got &quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cov_data</span><span class="o">.</span><span class="n">shape</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cov_data</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">cov_data</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">if</span> <span class="n">cov_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cov_cols</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">):</span>
                        <span class="n">cov_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cols</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data_cols</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="si">}</span><span class="s2">_cov&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">)</span> <span class="o">==</span> <span class="n">cov_dims</span> <span class="ow">and</span>
                        <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">vcol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="n">cov_cols</span><span class="p">])),</span> \
                    <span class="s2">&quot;New &#39;cov_cols&#39; attribute must be a list of strings of length &quot;</span> \
                    <span class="s2">&quot;corresponding to all possible covariances &quot;</span> \
                    <span class="sa">f</span><span class="s2">&quot;( expected </span><span class="si">{</span><span class="n">cov_dims</span><span class="si">}</span><span class="s2">, got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">for</span> <span class="n">iccol</span><span class="p">,</span> <span class="n">ccol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="n">cov_data</span><span class="p">[:,</span> <span class="n">iccol</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_cov_map</span> <span class="o">=</span> <span class="n">make_cov_index_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="o">=</span> <span class="n">cov_cols</span></div>


<div class="viewcode-block" id="Timeseries.copy">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">only_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a deep copy of the timeseries instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        only_data</span>
<span class="sd">            If ``True``, only copy the data columns and ignore any uncertainty information.</span>
<span class="sd">        src</span>
<span class="sd">            Set a new source information attribute for the copy.</span>
<span class="sd">            Uses the current one if ``None``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Timeseries</span>
<span class="sd">            The copy of the timeseries instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_name</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">)</span> <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">src</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">new_name</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_unit</span><span class="p">),</span>
                              <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">),</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">),</span>
                              <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">new_name</span><span class="p">,</span>
                              <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_unit</span><span class="p">),</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.convert_units">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.convert_units">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">new_data_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the data and covariances to a new data unit by providing a</span>
<span class="sd">        conversion factor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        factor</span>
<span class="sd">            Factor to multiply the data by to obtain the data in the new units.</span>
<span class="sd">        new_data_unit</span>
<span class="sd">            New data unit to be saved in the :attr:`~data_cols` attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># input checks</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;factor&#39; and has to be a scalar, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
        <span class="c1"># update data unit (contains input check)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_unit</span> <span class="o">=</span> <span class="n">new_data_unit</span>
        <span class="c1"># convert data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="c1"># convert variances</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># convert covariances</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span></div>


<div class="viewcode-block" id="Timeseries.mask_out">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.mask_out">[docs]</a>
    <span class="k">def</span> <span class="nf">mask_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dcol</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mask out an entire data column (and if present, its uncertainty column) by setting</span>
<span class="sd">        the entire column to ``NaN``. Converts it to a sparse representation to save memory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dcol</span>
<span class="sd">            Name of the data column to mask out.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">icomp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dcol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">dcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">dcol</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">dcol</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">SparseDtype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_cols</span><span class="p">[</span><span class="n">icomp</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">vcol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">vcol</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">vcol</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">SparseDtype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">iccol</span> <span class="ow">in</span> <span class="n">get_cov_indices</span><span class="p">(</span><span class="n">icomp</span><span class="p">,</span> <span class="n">index_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">index_map</span><span class="p">):</span>
                    <span class="n">ccol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cov_cols</span><span class="p">[</span><span class="n">iccol</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">ccol</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df</span><span class="p">[</span><span class="n">ccol</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">SparseDtype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span></div>


<div class="viewcode-block" id="Timeseries.prepare_math">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.prepare_math">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">prepare_math</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Timeseries</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                     <span class="n">right</span><span class="p">:</span> <span class="n">Timeseries</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                     <span class="n">operation</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">]</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests two timeseries&#39; ability to be cast together in a mathematical operation,</span>
<span class="sd">        and returns output characteristics.</span>
<span class="sd">        Currently, only addition, subtraction, multiplication, and division are supported.</span>

<span class="sd">        All uncertainty information is lost during mathematical operations.</span>

<span class="sd">        One of the objects can be a NumPy array. In this case, the array has to have</span>
<span class="sd">        the exact same shape as the data in the Timeseries instance.</span>
<span class="sd">        Furthermore, the resulting Timeseries object will have the same :attr:`~src`,</span>
<span class="sd">        :attr:`~data_unit` and :attr:`~data_cols` attributes (instead of a combination</span>
<span class="sd">        of both).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        left</span>
<span class="sd">            Left term of the operation.</span>
<span class="sd">        right</span>
<span class="sd">            Right term of the operation.</span>
<span class="sd">        operation</span>
<span class="sd">            Operation to perform.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        left_data</span>
<span class="sd">            View of the 2D left data array of the operation</span>
<span class="sd">            with shape (``len(out_time)``, :attr:`~num_components`).</span>
<span class="sd">        right_data</span>
<span class="sd">            View of the 2D right data array of the operation</span>
<span class="sd">            with shape (``len(out_time)``, :attr:`~num_components`).</span>
<span class="sd">        out_src</span>
<span class="sd">            Combines the sources of each object to a new string.</span>
<span class="sd">        out_data_unit</span>
<span class="sd">            Combines the data units of each object into a new unit.</span>
<span class="sd">        out_data_cols</span>
<span class="sd">            List of strings containing the new data column names.</span>
<span class="sd">        out_time</span>
<span class="sd">            Index object containing the indices of all timestamps common to both.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If one of the operands is not a :class:`~Timeseries` or :class:`~numpy.ndarray`,</span>
<span class="sd">            or if both are :class:`~numpy.ndarray` (since then this function would never be</span>
<span class="sd">            called anyway).</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of data columns is not equal between the two operands,</span>
<span class="sd">            or if the data units are not the same adding or subtracting.</span>
<span class="sd">        AssertionError</span>
<span class="sd">            If one of the operands is a NumPy array but does not have the same number of</span>
<span class="sd">            rows as the other operand.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        This method is called under-the-hood whenever a mathematical operation is</span>
<span class="sd">        performed, and should not need to be used by normal users.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        __add__ : Addition for two Timeseries or a Timeseries and a NumPy array</span>
<span class="sd">        __radd__ : Addition for a NumPy array and a Timeseries.</span>
<span class="sd">        __sub__ : Subtraction for two Timeseries or a Timeseries and a NumPy array</span>
<span class="sd">        __rsub__ : Subtraction for a NumPy array and a Timeseries.</span>
<span class="sd">        __mul__ : Multiplication for two Timeseries or a Timeseries and a NumPy array</span>
<span class="sd">        __rmul__ : Multiplication for a NumPy array and a Timeseries.</span>
<span class="sd">        __truediv__ : Division for two Timeseries or a Timeseries and a NumPy array</span>
<span class="sd">        __rtruediv__ : Division for a NumPy array and a Timeseries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check for valid operator</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Timeseries math problem: &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;unknown operation &#39;</span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="c1"># check for compatible types</span>
        <span class="k">for</span> <span class="n">operand</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Left&quot;</span><span class="p">,</span> <span class="s2">&quot;Right&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2"> operand has to be either a &#39;</span><span class="si">{</span><span class="n">Timeseries</span><span class="si">}</span><span class="s2">&#39; or &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="si">}</span><span class="s2">&#39; object, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">]]):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;At least one of the operands has to be a &#39;</span><span class="si">{</span><span class="n">Timeseries</span><span class="si">}</span><span class="s2">&#39; object, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;got two &#39;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="si">}</span><span class="s2">&#39; objects.&quot;</span><span class="p">)</span>
        <span class="c1"># check for same dimensions</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">):</span>
            <span class="n">len_left_data_cols</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">num_components</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">len_left_data_cols</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">Timeseries</span><span class="p">):</span>
            <span class="n">len_right_data_cols</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">num_components</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">len_right_data_cols</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">len_left_data_cols</span> <span class="o">!=</span> <span class="n">len_right_data_cols</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timeseries math problem: conflicting number of data columns &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">len_left_data_cols</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">len_right_data_cols</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">)</span>
        <span class="c1"># get output attributes</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">right</span><span class="o">.</span><span class="n">num_observations</span><span class="p">,</span> \
                <span class="s2">&quot;Timeseries math problem: conflicting number of observation &quot;</span> <span class="o">+</span> \
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">left</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">right</span><span class="o">.</span><span class="n">num_observations</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="n">out_time</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">time</span>
            <span class="n">out_src</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">src</span>
            <span class="n">out_data_unit</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">data_unit</span>
            <span class="n">out_data_cols</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">data_cols</span>
            <span class="n">left_data</span> <span class="o">=</span> <span class="n">left</span>
            <span class="n">right_data</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">out_time</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">left</span><span class="o">.</span><span class="n">num_observations</span> <span class="o">==</span> <span class="n">right</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
                <span class="s2">&quot;Timeseries math problem: conflicting number of observation &quot;</span> <span class="o">+</span> \
                <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">left</span><span class="o">.</span><span class="n">num_observations</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">right</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="n">out_time</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">time</span>
            <span class="n">out_src</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">src</span>
            <span class="n">out_data_unit</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">data_unit</span>
            <span class="n">out_data_cols</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">data_cols</span>
            <span class="n">left_data</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">out_time</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">right_data</span> <span class="o">=</span> <span class="n">right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># time index is the intersection</span>
            <span class="n">out_time</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1"># check compatible units (+-) or define new one (*/)</span>
            <span class="c1"># define new src and data_cols</span>
            <span class="k">if</span> <span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">left</span><span class="o">.</span><span class="n">data_unit</span> <span class="o">!=</span> <span class="n">right</span><span class="o">.</span><span class="n">data_unit</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timeseries math problem: conflicting data units &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">left</span><span class="o">.</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">right</span><span class="o">.</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out_data_unit</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">data_unit</span>
                    <span class="n">out_src</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left</span><span class="o">.</span><span class="n">src</span><span class="si">}{</span><span class="n">operation</span><span class="si">}{</span><span class="n">right</span><span class="o">.</span><span class="n">src</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">out_data_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">lcol</span><span class="si">}{</span><span class="n">operation</span><span class="si">}{</span><span class="n">rcol</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">lcol</span><span class="p">,</span> <span class="n">rcol</span>
                                     <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">data_cols</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">data_cols</span><span class="p">)]</span>
            <span class="k">elif</span> <span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">]:</span>
                <span class="n">out_data_unit</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">left</span><span class="o">.</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">right</span><span class="o">.</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">out_src</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">left</span><span class="o">.</span><span class="n">src</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">right</span><span class="o">.</span><span class="n">src</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">out_data_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">lcol</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">rcol</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">lcol</span><span class="p">,</span> <span class="n">rcol</span>
                                 <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">data_cols</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">data_cols</span><span class="p">)]</span>
            <span class="n">left_data</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">out_time</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
            <span class="n">right_data</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">out_time</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
        <span class="c1"># return data unit and column names</span>
        <span class="k">return</span> <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_data_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span></div>


<div class="viewcode-block" id="Timeseries.__add__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__add__">[docs]</a>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Special function that allows two timeseries instances (or a timeseries and</span>
<span class="sd">        an equivalently shaped NumPy array) to be added together element-wise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other</span>
<span class="sd">            Timeseries to add to instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            New timeseries object containing the sum of the two timeseries.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        prepare_math</span>
<span class="sd">            Prepares the two instances for the mathematical operation. Refer to it</span>
<span class="sd">            for more details about how the two objects are cast together.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        Add two :class:`~Timeseries` ``ts1`` and ``ts2`` and save the result as ``ts3``::</span>

<span class="sd">            ts3 = ts1 + ts2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">+</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.__radd__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__radd__">[docs]</a>
    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reflected operation of :meth:`~__add__` (necessary if first operand is a NumPy array).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">+</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.__sub__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__sub__">[docs]</a>
    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Special function that allows a timeseries instance (or a timeseries and</span>
<span class="sd">        an equivalently shaped NumPy array) to be subtracted from another element-wise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other</span>
<span class="sd">            Timeseries to subtract from instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            New timeseries object containing the difference of the two timeseries.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        prepare_math</span>
<span class="sd">            Prepares the two instances for the mathematical operation. Refer to it</span>
<span class="sd">            for more details about how the two objects are cast together.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        Subtract two :class:`~Timeseries` ``ts1`` and ``ts2`` and save the result as ``ts3``::</span>

<span class="sd">            ts3 = ts1 - ts2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">-</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.__rsub__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__rsub__">[docs]</a>
    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reflected operation of :meth:`~__sub__` (necessary if first operand is a NumPy array).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">-</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.__mul__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__mul__">[docs]</a>
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Special function that allows two timeseries instances (or a timeseries and</span>
<span class="sd">        an equivalently shaped NumPy array) to be multiplied together element-wise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other</span>
<span class="sd">            Timeseries to multiply to instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            New timeseries object containing the product of the two timeseries.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        prepare_math</span>
<span class="sd">            Prepares the two instances for the mathematical operation. Refer to it</span>
<span class="sd">            for more details about how the two objects are cast together.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        Multiply two :class:`~Timeseries` ``ts1`` and ``ts2`` and save the result as ``ts3``::</span>

<span class="sd">            ts3 = ts1 * ts2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">*</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.__rmul__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__rmul__">[docs]</a>
    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reflected operation of :meth:`~__mul__` (necessary if first operand is a NumPy array).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">*</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.__truediv__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__truediv__">[docs]</a>
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Special function that allows a timeseries instances (or a timeseries and</span>
<span class="sd">        an equivalently shaped NumPy array) to be divided by another element-wise.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other</span>
<span class="sd">            Timeseries to divide instance by.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            New timeseries object containing the quotient of the two timeseries.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        prepare_math</span>
<span class="sd">            Prepares the two instances for the mathematical operation. Refer to it</span>
<span class="sd">            for more details about how the two objects are cast together.</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        Divide two :class:`~Timeseries` ``ts1`` and ``ts2`` and save the result as ``ts3``::</span>

<span class="sd">            ts3 = ts1 / ts2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">/</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.__rtruediv__">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.__rtruediv__">[docs]</a>
    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Timeseries</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reflected operation of :meth:`~__truediv__` (necessary if first operand is a NumPy array).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left_data</span><span class="p">,</span> <span class="n">right_data</span><span class="p">,</span> <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">,</span> <span class="n">out_time</span> <span class="o">=</span> \
            <span class="n">Timeseries</span><span class="o">.</span><span class="n">prepare_math</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Timeseries</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">left_data</span> <span class="o">/</span> <span class="n">right_data</span><span class="p">,</span>
                                       <span class="n">index</span><span class="o">=</span><span class="n">out_time</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">out_data_cols</span><span class="p">),</span>
                          <span class="n">out_src</span><span class="p">,</span> <span class="n">out_unit</span><span class="p">,</span> <span class="n">out_data_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.get_arch">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.get_arch">[docs]</a>
    <span class="k">def</span> <span class="nf">get_arch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a dictionary describing the architecture of this timeseries,</span>
<span class="sd">        to be used when creating a network JSON configuration file.</span>

<span class="sd">        Without subclassing :class:`~Timeseries`, this function will return an</span>
<span class="sd">        empty dictionary by default, since it is unknown how to recreate</span>
<span class="sd">        a general Timeseries object from just a JSON-compatible dictionary.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        disstans.network.Network.to_json : Export the Network configuration as a JSON file.</span>
<span class="sd">        disstans.timeseries.Timeseries.get_arch</span>
<span class="sd">            Get the architecture dictionary of a :class:`~disstans.timeseries.Timeseries` instance.</span>
<span class="sd">        disstans.models.Model.get_arch</span>
<span class="sd">            Get the architecture dictionary of a :class:`~disstans.models.Model` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span></div>


<div class="viewcode-block" id="Timeseries.from_fit">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.from_fit">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_fit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">data_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">data_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">fit</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Import a fit dictionary and create a Timeseries instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_unit</span>
<span class="sd">            Data unit.</span>
<span class="sd">        data_cols</span>
<span class="sd">            List of strings containing the data column names.</span>
<span class="sd">            Uncertainty column names are generated by adding a &#39;_var&#39;.</span>
<span class="sd">        fit</span>
<span class="sd">            Dictionary with the keys ``&#39;time&#39;``, ``&#39;fit&#39;``, ``&#39;var&#39;`` and ``&#39;cov&#39;``</span>
<span class="sd">            (the latter two can be set to ``None``).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Timeseries instance created from ``fit``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        disstans.models.Model.evaluate</span>
<span class="sd">            Evaluating a model produces the fit dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">dcol</span><span class="p">:</span> <span class="n">fit</span><span class="p">[</span><span class="s2">&quot;fit&quot;</span><span class="p">][:,</span> <span class="n">icol</span><span class="p">]</span> <span class="k">for</span> <span class="n">icol</span><span class="p">,</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_cols</span><span class="p">)}</span>
        <span class="n">var_cols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cov_cols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fit</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dcol</span> <span class="o">+</span> <span class="s2">&quot;_var&quot;</span> <span class="k">for</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="n">data_cols</span><span class="p">]</span>
            <span class="n">df_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">vcol</span><span class="p">:</span> <span class="n">fit</span><span class="p">[</span><span class="s2">&quot;var&quot;</span><span class="p">][:,</span> <span class="n">icol</span><span class="p">]</span> <span class="k">for</span> <span class="n">icol</span><span class="p">,</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_cols</span><span class="p">)})</span>
            <span class="k">if</span> <span class="n">fit</span><span class="p">[</span><span class="s2">&quot;cov&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cov_cols</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">num_components</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_cols</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_components</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_components</span><span class="p">):</span>
                        <span class="n">cov_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_cols</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">data_cols</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="si">}</span><span class="s2">_cov&quot;</span><span class="p">)</span>
                <span class="n">df_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ccol</span><span class="p">:</span> <span class="n">fit</span><span class="p">[</span><span class="s2">&quot;cov&quot;</span><span class="p">][:,</span> <span class="n">icol</span><span class="p">]</span> <span class="k">for</span> <span class="n">icol</span><span class="p">,</span> <span class="n">ccol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">)})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">fit</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;fitted&quot;</span><span class="p">,</span> <span class="n">data_unit</span><span class="p">,</span> <span class="n">data_cols</span><span class="p">,</span> <span class="n">var_cols</span><span class="p">,</span> <span class="n">cov_cols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timeseries.from_array">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.Timeseries.from_array">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_array</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                   <span class="n">timevector</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">,</span>
                   <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                   <span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">data_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">data_cols</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">var</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">var_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">cov</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">cov_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor method to create a :class:`~Timeseries` instance from a NumPy</span>
<span class="sd">        :class:`~numpy.ndarray`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        timevector</span>
<span class="sd">            :class:`~pandas.Series` of :class:`~pandas.Timestamp` or alternatively a</span>
<span class="sd">            :class:`~pandas.DatetimeIndex` containing the timestamps of each observation.</span>
<span class="sd">        data</span>
<span class="sd">            2D NumPy array of shape :math:`(\text{n_observations},\text{n_components})`</span>
<span class="sd">            containing the data.</span>
<span class="sd">        src</span>
<span class="sd">            Source description.</span>
<span class="sd">        data_unit</span>
<span class="sd">            Data unit.</span>
<span class="sd">        data_cols</span>
<span class="sd">            List of strings with the names of the columns of ``data``.</span>
<span class="sd">        var</span>
<span class="sd">            2D NumPy array of shape :math:`(\text{n_observations},\text{n_components})`</span>
<span class="sd">            containing the data variances.</span>
<span class="sd">            ``None`` defaults to no data uncertainty.</span>
<span class="sd">        var_cols</span>
<span class="sd">            List of strings with the names of the columns of ``data`` that contain the</span>
<span class="sd">            data&#39;s variance.</span>
<span class="sd">            Must have the same length as ``data_cols``.</span>
<span class="sd">            If ``var`` is given but ``var_cols`` is not, it defaults to appending</span>
<span class="sd">            ``&#39;_var&#39;`` to ``data_cols``.</span>
<span class="sd">        cov</span>
<span class="sd">            2D NumPy array of shape :math:`(\text{n_observations},\text{n_components})`</span>
<span class="sd">            containing the data covariances (as defined in :class:`~Timeseries`).</span>
<span class="sd">            ``None`` defaults to no data uncertainty.</span>
<span class="sd">        cov_cols</span>
<span class="sd">            List of strings with the names of the columns of ``data`` that contain the</span>
<span class="sd">            data&#39;s covariance.</span>
<span class="sd">            Must have the same length as ``data_cols``.</span>
<span class="sd">            If ``cov`` is given but ``cov_cols`` is not, it defaults to appending</span>
<span class="sd">            ``&#39;_cov&#39;`` to the two respective entries of ``data_cols``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            The generated Timeseries object.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`~pandas.date_range` : Quick function to generate a timevector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">timevector</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> \
            <span class="s2">&quot;Length of &#39;timevector&#39; has to match the number of rows in &#39;data&#39;, &quot;</span> \
            <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">timevector</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dcol</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="n">data_cols</span><span class="p">]),</span> \
            <span class="sa">f</span><span class="s2">&quot;&#39;data_cols&#39; has to be a list of strings, got </span><span class="si">{</span><span class="n">data_cols</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="c1"># create dataframe with data</span>
        <span class="n">df_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">dcol</span><span class="p">:</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">icol</span><span class="p">]</span> <span class="k">for</span> <span class="n">icol</span><span class="p">,</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_cols</span><span class="p">)}</span>
        <span class="c1"># add variances</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">var_cols</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> \
                <span class="s2">&quot;&#39;data&#39; and &#39;var&#39; need to have the same shape, got &quot;</span> \
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">if</span> <span class="n">var_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">var_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">dcol</span> <span class="o">+</span> <span class="s2">&quot;_var&quot;</span> <span class="k">for</span> <span class="n">dcol</span> <span class="ow">in</span> <span class="n">data_cols</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_cols</span><span class="p">)</span> <span class="o">==</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">df_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">vcol</span><span class="p">:</span> <span class="n">var</span><span class="p">[:,</span> <span class="n">icol</span><span class="p">]</span> <span class="k">for</span> <span class="n">icol</span><span class="p">,</span> <span class="n">vcol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_cols</span><span class="p">)})</span>
            <span class="c1"># if variances are given, can also check for covariances</span>
            <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cov_cols</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_components</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cov_dims</span> <span class="o">=</span> <span class="n">get_cov_dims</span><span class="p">(</span><span class="n">num_components</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cov</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cov</span> <span class="o">=</span> <span class="n">cov</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">cov</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cov_dims</span><span class="p">),</span> \
                    <span class="s2">&quot;&#39;data&#39; and &#39;cov&#39; need to have compatible shapes, got &quot;</span> \
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">cov</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> (need </span><span class="si">{</span><span class="n">cov_dims</span><span class="si">}</span><span class="s2"> columns).&quot;</span>
                <span class="k">if</span> <span class="n">cov_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cov_cols</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_components</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_components</span><span class="p">):</span>
                            <span class="n">cov_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_cols</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">data_cols</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="si">}</span><span class="s2">_cov&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">)</span> <span class="o">==</span> <span class="n">cov</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">df_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ccol</span><span class="p">:</span> <span class="n">cov</span><span class="p">[:,</span> <span class="n">icol</span><span class="p">]</span> <span class="k">for</span> <span class="n">icol</span><span class="p">,</span> <span class="n">ccol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cov_cols</span><span class="p">)})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">timevector</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">data_unit</span><span class="p">,</span> <span class="n">data_cols</span><span class="p">,</span> <span class="n">var_cols</span><span class="p">,</span> <span class="n">cov_cols</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="GipsyTimeseries">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.GipsyTimeseries">[docs]</a>
<span class="k">class</span> <span class="nc">GipsyTimeseries</span><span class="p">(</span><span class="n">Timeseries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclasses :class:`~Timeseries`.</span>

<span class="sd">    Timeseries subclass for GNSS measurements in JPL&#39;s Gipsy(X) ``.tseries`` file format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path</span>
<span class="sd">        Path to the timeseries file.</span>
<span class="sd">    show_warnings</span>
<span class="sd">        If ``True``, warn if there are data inconsistencies encountered while loading.</span>
<span class="sd">    data_unit</span>
<span class="sd">        Can be ``&#39;mm&#39;`` or ``&#39;m&#39;``.</span>
<span class="sd">    keep_duplicates</span>
<span class="sd">        Argument passed on to :meth:`~pandas.DataFrame.drop_duplicates` as the ``keep``</span>
<span class="sd">        parameter when finding duplicate times, but with ``False`` as the default</span>
<span class="sd">        (since duplicate timestamps usually imply bad data - legacy behavior would be</span>
<span class="sd">        to pass ``&#39;first&#39;``).</span>


<span class="sd">    Additional keyword arguments will be passed onto :class:`~Timeseries`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The column format is described on `JPL&#39;s website`_:</span>

<span class="sd">    +---------------+-------------------------------------------------+</span>
<span class="sd">    | Columns       | Description                                     |</span>
<span class="sd">    +===============+=================================================+</span>
<span class="sd">    | Column 1      | Decimal year computed with 365.25 days/yr       |</span>
<span class="sd">    +---------------+-------------------------------------------------+</span>
<span class="sd">    | Columns 2-4   | East, North and Vertical [m]                    |</span>
<span class="sd">    +---------------+-------------------------------------------------+</span>
<span class="sd">    | Columns 5-7   | East, North and Vertical standard deviation [m] |</span>
<span class="sd">    +---------------+-------------------------------------------------+</span>
<span class="sd">    | Columns 8-10  | East, North and Vertical correlation [-]        |</span>
<span class="sd">    +---------------+-------------------------------------------------+</span>
<span class="sd">    | Column 11     | Time in Seconds past J2000                      |</span>
<span class="sd">    +---------------+-------------------------------------------------+</span>
<span class="sd">    | Columns 12-17 | Time in YEAR MM DD HR MN SS                     |</span>
<span class="sd">    +---------------+-------------------------------------------------+</span>

<span class="sd">    Time is GPS time, and the time series are relative to each station&#39;s first epoch.</span>

<span class="sd">    .. _JPL&#39;s website: https://sideshow.jpl.nasa.gov/pub/JPL_GPS_Timeseries/\</span>
<span class="sd">repro2018a/raw/position/envseries/0000_README.format</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">show_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">data_unit</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span>
                 <span class="n">keep_duplicates</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;first&quot;</span><span class="p">,</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kw_args</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_duplicates</span> <span class="o">=</span> <span class="n">keep_duplicates</span>
        <span class="k">if</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;data_unit&#39; needs to be &#39;mm&#39; or &#39;m&#39;, got </span><span class="si">{</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="c1"># load data</span>
        <span class="n">data_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">]</span>
        <span class="n">var_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;east_var&quot;</span><span class="p">,</span> <span class="s2">&quot;north_var&quot;</span><span class="p">,</span> <span class="s2">&quot;up_var&quot;</span><span class="p">]</span>
        <span class="n">cov_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;east_north_cov&quot;</span><span class="p">,</span> <span class="s2">&quot;east_up_cov&quot;</span><span class="p">,</span> <span class="s2">&quot;north_up_cov&quot;</span><span class="p">]</span>
        <span class="n">all_cols</span> <span class="o">=</span> <span class="n">data_cols</span> <span class="o">+</span> <span class="n">var_cols</span> <span class="o">+</span> <span class="n">cov_cols</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
                           <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;minute&quot;</span><span class="p">,</span> <span class="s2">&quot;second&quot;</span><span class="p">])</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                           <span class="n">names</span><span class="o">=</span><span class="n">all_cols</span><span class="p">)</span>
        <span class="c1"># compute covariance from correlation, still in meters</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;east_north_cov&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;east_var&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;north_var&quot;</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;east_up_cov&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;east_var&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;up_var&quot;</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;north_up_cov&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;north_var&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;up_var&quot;</span><span class="p">]</span>
        <span class="c1"># convert standard deviation into variance, still in meters</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">var_cols</span><span class="p">]</span> <span class="o">*=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">var_cols</span><span class="p">]</span>
        <span class="c1"># now convert everything to millimeters</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">data_cols</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">var_cols</span> <span class="o">+</span> <span class="n">cov_cols</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># combine dataframe with time</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># check for duplicate timestamps</span>
        <span class="n">num_duplicates</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">num_duplicates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_warnings</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains data for </span><span class="si">{</span><span class="n">num_duplicates</span><span class="si">}</span><span class="s2"> &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;duplicate times, dealing with them using &#39;keep=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_keep_duplicates</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
                     <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_keep_duplicates</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># create time index</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># check for monotonic time index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_monotonic_increasing</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> is not ordered in time, sorting it now.&quot;</span><span class="p">,</span>
                 <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># construct Timeseries object</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;Gipsy&quot;</span><span class="p">,</span> <span class="n">data_unit</span><span class="o">=</span><span class="n">data_unit</span><span class="p">,</span>
                         <span class="n">data_cols</span><span class="o">=</span><span class="n">data_cols</span><span class="p">,</span> <span class="n">var_cols</span><span class="o">=</span><span class="n">var_cols</span><span class="p">,</span> <span class="n">cov_cols</span><span class="o">=</span><span class="n">cov_cols</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>

<div class="viewcode-block" id="GipsyTimeseries.get_arch">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.GipsyTimeseries.get_arch">[docs]</a>
    <span class="k">def</span> <span class="nf">get_arch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a JSON-compatible dictionary with all the information necessary to recreate</span>
<span class="sd">        the Timeseries instance (provided the data file is available).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            JSON-compatible dictionary sufficient to recreate the GipsyTimeseries instance.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        Timeseries.get_arch : For further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;GipsyTimeseries&quot;</span><span class="p">,</span>
                <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span>
                            <span class="s2">&quot;keep_duplicates&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_duplicates</span><span class="p">}}</span></div>
</div>



<span class="n">GipsyXTimeseries</span> <span class="o">=</span> <span class="n">GipsyTimeseries</span>
<span class="sd">&quot;&quot;&quot; Alias for :class:`~GipsyTimeseries`. &quot;&quot;&quot;</span>


<div class="viewcode-block" id="UNRTimeseries">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.UNRTimeseries">[docs]</a>
<span class="k">class</span> <span class="nc">UNRTimeseries</span><span class="p">(</span><span class="n">Timeseries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclasses :class:`~Timeseries`.</span>

<span class="sd">    Timeseries subclass for GNSS measurements in UNR&#39;s ``.tenv3`` file format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path</span>
<span class="sd">        Path to the timeseries file.</span>
<span class="sd">    show_warnings</span>
<span class="sd">        If ``True``, warn if there are data inconsistencies encountered while loading.</span>
<span class="sd">    data_unit</span>
<span class="sd">        Can be ``&#39;mm&#39;`` or ``&#39;m&#39;``.</span>


<span class="sd">    Additional keyword arguments will be passed onto :class:`~Timeseries`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The column format is described on `UNR&#39;s website`_:</span>

<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns       | Description                                       |</span>
<span class="sd">    +===============+===================================================+</span>
<span class="sd">    | Column 1      | Station name                                      |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 2      | Date                                              |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 3      | Decimal year                                      |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 4      | Modified Julian day                               |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 5-6   | GPS week and day                                  |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 7      | Longitude [] of reference meridian               |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 8-9   | Easting [m] from ref. mer., integer and fraction  |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 10-11 | Northing [m] from equator, integer and fraction   |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 12-13 | Vertical [m], integer and fraction                |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 14     | Antenna height [m]                                |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 15-17  | East, North, Vertical standard deviation [m]      |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 18     | East-North correlation coefficient [-]            |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 19     | East-Vertical correlation coefficient [-]         |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 20     | North-Vertical correlation coefficient [-]        |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>

<span class="sd">    Newer files also contain the following three columns:</span>

<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 21     | Latitude []                                      |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 22     | Longitude []                                     |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 23     | Altitude [m]                                      |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>

<span class="sd">    The time series are relative to each station&#39;s first integer epoch.</span>

<span class="sd">    .. _UNR&#39;s website: http://geodesy.unr.edu/gps_timeseries/README_tenv3.txt</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">show_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">data_unit</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kw_args</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;data_unit&#39; needs to be &#39;mm&#39; or &#39;m&#39;, got </span><span class="si">{</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="c1"># load data and check for some warnings</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
                         <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">20</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">show_warnings</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains multiple site codes: &quot;</span>
                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;reflon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">calculate_stepdates</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">show_warnings</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains multiple reference longitudes: &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;reflon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">. Step dates will be saved to &quot;</span>
                     <span class="s2">&quot;&#39;self._reflonsteptimes&#39; and should be added as free model parameters, &quot;</span>
                     <span class="s2">&quot;or the affected observations should be removed.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">calculate_stepdates</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;_e0(m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_warnings</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains multiple integer &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;Eastings: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;_e0(m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">offsets_east</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;_e0(m)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;_e0(m)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offsets_east</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;____n0(m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_warnings</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains multiple integer &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;Northings: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;____n0(m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">offsets_north</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;____n0(m)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;____n0(m)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offsets_north</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;u0(m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">show_warnings</span><span class="p">:</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains multiple integer &quot;</span>
                     <span class="sa">f</span><span class="s2">&quot;Verticals: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;u0(m)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">offsets_up</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;u0(m)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;u0(m)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offsets_up</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># make the data</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;__east(m)&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offsets_east</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;north&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;_north(m)&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offsets_north</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;____up(m)&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">offsets_up</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;_e0(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;__east(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;____n0(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;_north(m)&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;u0(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;____up(m)&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># make the covariance</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;__corr_en&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_e(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_n(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;__corr_eu&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_e(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_u(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;__corr_nu&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_n(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_u(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;__corr_en&quot;</span><span class="p">:</span> <span class="s2">&quot;east_north_cov&quot;</span><span class="p">,</span> <span class="s2">&quot;__corr_eu&quot;</span><span class="p">:</span> <span class="s2">&quot;east_up_cov&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;__corr_nu&quot;</span><span class="p">:</span> <span class="s2">&quot;north_up_cov&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># make the variance</span>
        <span class="n">old_sig_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sig_e(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_n(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_u(m)&quot;</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">old_sig_cols</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">old_sig_cols</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sig_e(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;east_var&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_n(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;north_var&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;sig_u(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;up_var&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># check for duplicate timestamps and create time index</span>
        <span class="n">num_duplicates</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;__MJD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">show_warnings</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num_duplicates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains data for </span><span class="si">{</span><span class="n">num_duplicates</span><span class="si">}</span><span class="s2"> &quot;</span>
                 <span class="s2">&quot;duplicate dates. Keeping first occurrences.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;__MJD&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;__MJD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;__MJD&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2400000.5</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;julian&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;__MJD&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># check for monotonic time index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_monotonic_increasing</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> is not ordered in time, sorting it now.&quot;</span><span class="p">,</span>
                 <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># calculate step dates for multiple reference meridians</span>
        <span class="k">if</span> <span class="n">calculate_stepdates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reflonsteptimes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;reflon&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># remove columns that are no longer needed</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="p">,</span> <span class="s2">&quot;reflon&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># construct Timeseries object</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;UNR&quot;</span><span class="p">,</span> <span class="n">data_unit</span><span class="o">=</span><span class="n">data_unit</span><span class="p">,</span>
                         <span class="n">data_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">],</span>
                         <span class="n">var_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;east_var&quot;</span><span class="p">,</span> <span class="s2">&quot;north_var&quot;</span><span class="p">,</span> <span class="s2">&quot;up_var&quot;</span><span class="p">],</span>
                         <span class="n">cov_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;east_north_cov&quot;</span><span class="p">,</span> <span class="s2">&quot;east_up_cov&quot;</span><span class="p">,</span> <span class="s2">&quot;north_up_cov&quot;</span><span class="p">],</span>
                         <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>

<div class="viewcode-block" id="UNRTimeseries.get_arch">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.UNRTimeseries.get_arch">[docs]</a>
    <span class="k">def</span> <span class="nf">get_arch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a JSON-compatible dictionary with all the information necessary to recreate</span>
<span class="sd">        the Timeseries instance (provided the data file is available).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            JSON-compatible dictionary sufficient to recreate the UNRTimeseries instance.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        Timeseries.get_arch : For further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;UNRTimeseries&quot;</span><span class="p">,</span>
                <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">}}</span></div>
</div>



<div class="viewcode-block" id="UNRHighRateTimeseries">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.UNRHighRateTimeseries">[docs]</a>
<span class="k">class</span> <span class="nc">UNRHighRateTimeseries</span><span class="p">(</span><span class="n">Timeseries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Subclasses :class:`~Timeseries`.</span>

<span class="sd">    Timeseries subclass for GNSS measurements in UNR&#39;s ``.kenv`` file format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path</span>
<span class="sd">        Path to the timeseries file.</span>
<span class="sd">    show_warnings</span>
<span class="sd">        If ``True``, warn if there are data inconsistencies encountered while loading.</span>
<span class="sd">    data_unit</span>
<span class="sd">        Can be ``&#39;mm&#39;`` or ``&#39;m&#39;``.</span>


<span class="sd">    Additional keyword arguments will be passed onto :class:`~Timeseries`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The column format is described on `UNR&#39;s website`_:</span>

<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns       | Description                                       |</span>
<span class="sd">    +===============+===================================================+</span>
<span class="sd">    | Column 1      | Station name                                      |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 2      | GPS seconds since J2000                           |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 3      | Modified Julian Day for GPS day                   |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 4-7   | Year, month, day of month, day of year            |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Column 8      | Seconds of the GPS day                            |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 9-11  | East, North, Up from reference location           |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 12-14 | East, North, Up from daily mean position          |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>
<span class="sd">    | Columns 15-17 | East, North, Up standard deviations               |</span>
<span class="sd">    +---------------+---------------------------------------------------+</span>

<span class="sd">    Note that only the location timeseries relative to the reference locations</span>
<span class="sd">    is loaded.</span>
<span class="sd">    The timestamp associated with each observation is in Terrestrial Time.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">show_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">data_unit</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kw_args</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;data_unit&#39; needs to be &#39;mm&#39; or &#39;m&#39;, got </span><span class="si">{</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="c1"># load data</span>
        <span class="n">pathobj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">)</span>
        <span class="c1"># if the path is a folder or a .kenv.zip file, we need to concatenate files</span>
        <span class="k">if</span> <span class="n">pathobj</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">or</span> <span class="n">pathobj</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;*.kenv.zip&quot;</span><span class="p">):</span>
            <span class="c1"># collect list of files if path is a folder</span>
            <span class="k">if</span> <span class="n">pathobj</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">paths_years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pathobj</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.kenv.zip&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">paths_years</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathobj</span><span class="p">]</span>
            <span class="c1"># initialize memory buffer for pandas later</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="c1"># loop over years</span>
            <span class="k">for</span> <span class="n">path_y</span> <span class="ow">in</span> <span class="n">paths_years</span><span class="p">:</span>
                <span class="c1"># unzip year</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">path_y</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_y</span><span class="p">:</span>
                        <span class="c1"># get list of daily compressed files</span>
                        <span class="n">paths_days</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zip_y</span><span class="o">.</span><span class="n">namelist</span><span class="p">())</span>
                        <span class="c1"># load every day</span>
                        <span class="k">for</span> <span class="n">path_d</span> <span class="ow">in</span> <span class="n">paths_days</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">zip_y</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path_d</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_d</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">zip_d</span><span class="p">)</span> <span class="k">as</span> <span class="n">gz_d</span><span class="p">:</span>
                                        <span class="c1"># skip header line</span>
                                        <span class="n">gz_d</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                                        <span class="c1"># write to buffer</span>
                                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gz_d</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                                <span class="k">except</span> <span class="n">gzip</span><span class="o">.</span><span class="n">BadGzipFile</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting the file </span><span class="si">{</span><span class="n">path_y</span><span class="si">}</span><span class="s2">.&quot;</span>
                                                       <span class="p">)</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">LargeZipFile</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error extracting the file </span><span class="si">{</span><span class="n">path_y</span><span class="si">}</span><span class="s2">.&quot;</span>
                                       <span class="p">)</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
            <span class="c1"># load data into pandas</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
                             <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="p">,</span> <span class="s2">&quot;sec-J2000&quot;</span><span class="p">,</span> <span class="s2">&quot;___e-ref(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;___n-ref(m)&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;___v-ref(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_e(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_n(m)&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_v(m)&quot;</span><span class="p">],</span>
                             <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">)))</span>
        <span class="c1"># if the path is a .kenv.gz file, we only need to extract the single file</span>
        <span class="k">elif</span> <span class="n">pathobj</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;*.kenv.gz&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
                                 <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">)))</span>
        <span class="c1"># in all other cases, try loading directly</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
                             <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">)))</span>
        <span class="c1"># check for duplicate sites</span>
        <span class="k">if</span> <span class="n">show_warnings</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file/folder </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains multiple site codes: &quot;</span>
                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># remove site column</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># convert data units</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;___e-ref(m)&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;___n-ref(m)&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;___v-ref(m)&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="c1"># convert to variance and change units</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_e(m)&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_e(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_n(m)&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_n(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_v(m)&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sig_v(m)&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">factor</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># check for duplicate timestamps</span>
        <span class="n">num_duplicates</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;sec-J2000&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">show_warnings</span> <span class="ow">and</span> <span class="p">(</span><span class="n">num_duplicates</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file/folder </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> contains data for </span><span class="si">{</span><span class="n">num_duplicates</span><span class="si">}</span><span class="s2"> &quot;</span>
                 <span class="s2">&quot;duplicate timestamps. Keeping first occurrences.&quot;</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s2">&quot;sec-J2000&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># create time index and rename columns</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;sec-J2000&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2000-01-01 12:00:00&quot;</span><span class="p">)</span> <span class="o">+</span>
                           <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;sec-J2000&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">))</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;___e-ref(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_e(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;east_var&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;___n-ref(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_n(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;north_var&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;___v-ref(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="s2">&quot;sig_v(m)&quot;</span><span class="p">:</span> <span class="s2">&quot;up_var&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;sec-J2000&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># check for monotonic time index</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">is_monotonic_increasing</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeseries file/folder </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="si">}</span><span class="s2"> is not ordered in time, sorting it now.&quot;</span><span class="p">,</span>
                 <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># construct Timeseries object</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;UNRHighRate&quot;</span><span class="p">,</span> <span class="n">data_unit</span><span class="o">=</span><span class="n">data_unit</span><span class="p">,</span>
                         <span class="n">data_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">],</span>
                         <span class="n">var_cols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;east_var&quot;</span><span class="p">,</span> <span class="s2">&quot;north_var&quot;</span><span class="p">,</span> <span class="s2">&quot;up_var&quot;</span><span class="p">],</span>
                         <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>

<div class="viewcode-block" id="UNRHighRateTimeseries.get_arch">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.UNRHighRateTimeseries.get_arch">[docs]</a>
    <span class="k">def</span> <span class="nf">get_arch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a JSON-compatible dictionary with all the information necessary to recreate</span>
<span class="sd">        the Timeseries instance (provided the data file is available).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            JSON-compatible dictionary sufficient to recreate the UNRTimeseries instance.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        Timeseries.get_arch : For further information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;UNRHighRateTimeseries&quot;</span><span class="p">,</span>
                <span class="s2">&quot;kw_args&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">}}</span></div>
</div>



<div class="viewcode-block" id="F5File">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.F5File">[docs]</a>
<span class="k">class</span> <span class="nc">F5File</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reader class that parses the contents of a single F5 file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path</span>
<span class="sd">        Path to the F5 ``.pos`` file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F5COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;yyyy&quot;</span><span class="p">,</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="s2">&quot;dd&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:MM:SS&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;X (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Y (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Z (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Lat. (deg.)&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon. (deg.)&quot;</span><span class="p">,</span> <span class="s2">&quot;Height (m)&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Expected columns in the F5 file &quot;&quot;&quot;</span>
    <span class="n">F5DTYPES</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">F5COLUMNS</span><span class="p">[:</span><span class="mi">4</span><span class="p">]})</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Data types in the F5 file &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># open file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># continuously check whether the format is as expected</span>
            <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;+SITE/INF</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># read site info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="p">{</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                         <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]}</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Site information &quot;&quot;&quot;</span>
            <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;-SITE/INF</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;+SOLVER/INF</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># read solver info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solver</span> <span class="o">=</span> <span class="p">{</span><span class="n">elem</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elem</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                           <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]}</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Solver information &quot;&quot;&quot;</span>
            <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;-SOLVER/INF</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;+DATA</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># read data (omitting final &quot;-DATA&quot; row)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
                               <span class="n">names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">F5COLUMNS</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">F5DTYPES</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="c1"># parse date columns as datetime</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;yyyy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;yyyy&quot;</span><span class="p">,</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="s2">&quot;dd&quot;</span><span class="p">,</span> <span class="s2">&quot;HH:MM:SS&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F5COLUMNS</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;yyyy&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;%Y %m </span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># done</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Data block &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="F5Timeseries">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.F5Timeseries">[docs]</a>
<span class="k">class</span> <span class="nc">F5Timeseries</span><span class="p">(</span><span class="n">Timeseries</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subclasses :class:`~Timeseries`.</span>

<span class="sd">    Timeseries subclass for GNSS measurements in GEONET&#39;s ``.pos`` F5 file format.</span>
<span class="sd">    There is no (co)variance information, and the absolute coordinates are converted</span>
<span class="sd">    into differences in ENU coordinates from the first data point.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    paths</span>
<span class="sd">        List of filenames for the same station that are combined.</span>
<span class="sd">    data_unit</span>
<span class="sd">        Can be ``&#39;mm&#39;`` or ``&#39;m&#39;``.</span>


<span class="sd">    Additional keyword arguments will be passed onto :class:`~Timeseries`.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The column format is described in :attr:`~F5File.F5COLUMNS`</span>
<span class="sd">    The timezone assumed with each observation is UTC.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">paths</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">data_unit</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mm&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kw_args</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># initialize</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">])</span>
                <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)),</span> \
            <span class="sa">f</span><span class="s2">&quot;&#39;paths&#39; needs to be a list of string paths, got </span><span class="si">{</span><span class="n">paths</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="n">paths</span>
        <span class="k">if</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">data_unit</span> <span class="o">==</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;data_unit&#39; needs to be &#39;mm&#39; or &#39;m&#39;, got </span><span class="si">{</span><span class="n">data_unit</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="c1"># load individual files</span>
        <span class="n">f5files</span> <span class="o">=</span> <span class="p">[</span><span class="n">F5File</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span><span class="p">]</span>
        <span class="c1"># check that they&#39;re all for the same station</span>
        <span class="n">longname</span> <span class="o">=</span> <span class="n">f5files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">longname</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f5files</span><span class="p">]),</span> \
            <span class="sa">f</span><span class="s2">&quot;Found files for different stations: </span><span class="si">{</span><span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">f5files</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">shortname</span> <span class="o">=</span> <span class="n">f5files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="s2">&quot;RINEX&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">shortname</span> <span class="o">==</span> <span class="n">f</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="s2">&quot;RINEX&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f5files</span><span class="p">]),</span> \
            <span class="sa">f</span><span class="s2">&quot;Found files for different stations: </span><span class="si">{</span><span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="s1">&#39;RINEX&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">f5files</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># concatenate the data into a joint DataFrame</span>
        <span class="n">f5data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">data</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">f5files</span><span class="p">])</span>
        <span class="n">f5data</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># get first lat/lon/alt coordinates</span>
        <span class="n">ref_latlonalt</span> <span class="o">=</span> <span class="n">f5data</span><span class="p">[[</span><span class="s2">&quot;Lat. (deg.)&quot;</span><span class="p">,</span> <span class="s2">&quot;Lon. (deg.)&quot;</span><span class="p">,</span> <span class="s2">&quot;Height (m)&quot;</span><span class="p">]</span>
                               <span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
        <span class="c1"># get XYZ differences from first observations</span>
        <span class="n">rel_xyz</span> <span class="o">=</span> <span class="p">(</span><span class="n">f5data</span><span class="p">[[</span><span class="s2">&quot;X (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Y (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Z (m)&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
                   <span class="o">-</span> <span class="n">f5data</span><span class="p">[[</span><span class="s2">&quot;X (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Y (m)&quot;</span><span class="p">,</span> <span class="s2">&quot;Z (m)&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="c1"># calculate relative displacement in ENU</span>
        <span class="n">rot_mat</span> <span class="o">=</span> <span class="n">R_ecef2enu</span><span class="p">(</span><span class="n">ref_latlonalt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ref_latlonalt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rel_enu</span> <span class="o">=</span> <span class="n">rel_xyz</span> <span class="o">@</span> <span class="n">rot_mat</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># convert away from m if desired</span>
        <span class="k">if</span> <span class="n">data_unit</span> <span class="o">!=</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="n">rel_enu</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="c1"># build timeseries dataframe</span>
        <span class="n">data_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">,</span> <span class="s2">&quot;up&quot;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">f5data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rel_enu</span><span class="p">,</span>
                          <span class="n">columns</span><span class="o">=</span><span class="n">data_cols</span><span class="p">)</span>
        <span class="c1"># attach station ID and location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">longname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rinex</span> <span class="o">=</span> <span class="n">shortname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_location</span> <span class="o">=</span> <span class="n">ref_latlonalt</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># construct Timeseries object</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">dataframe</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;F5&quot;</span><span class="p">,</span> <span class="n">data_unit</span><span class="o">=</span><span class="n">data_unit</span><span class="p">,</span>
                         <span class="n">data_cols</span><span class="o">=</span><span class="n">data_cols</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>

<div class="viewcode-block" id="F5Timeseries.from_folder">
<a class="viewcode-back" href="../../disstans/timeseries.html#disstans.timeseries.F5Timeseries.from_folder">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">show_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kw_args</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="n">F5Timeseries</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the base folder of an F5 repository, find all F5 files and extract station names,</span>
<span class="sd">        locations, and timeseries.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder</span>
<span class="sd">            Base folder that contains the &quot;YYYY&quot; year folders with annual ``.pos`` F5 files</span>
<span class="sd">            inside of them.</span>
<span class="sd">        show_warnings</span>
<span class="sd">            If ``True``, warn if there are data inconsistencies encountered while loading.</span>
<span class="sd">        **kw_args</span>
<span class="sd">            Extra arguments that are passed on to the :class:`~F5Timeseries` constructor.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        names</span>
<span class="sd">            Station names.</span>
<span class="sd">        locations</span>
<span class="sd">            Station locations.</span>
<span class="sd">        timeseries</span>
<span class="sd">            Station :class:`~F5Timeseries` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># define filename patterns</span>
        <span class="n">globfile5</span> <span class="o">=</span> <span class="s2">&quot;[12][0-9][0-9][0-9]/[0-9][0-9][0-9][0-9][0-9].[0-9][0-9].pos&quot;</span>
        <span class="n">globfile6</span> <span class="o">=</span> <span class="s2">&quot;[12][0-9][0-9][0-9]/[0-9][0-9][0-9][0-9][0-9][0-9].[0-9][0-9].pos&quot;</span>
        <span class="c1"># find all files matching the 5- and 6-character length formats</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">globfile5</span><span class="p">)]</span> <span class="o">+</span>
                                <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">globfile6</span><span class="p">)])))</span>
        <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">timeseries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># loop over all stations to load their files</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Loading station files&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Station&quot;</span><span class="p">):</span>
            <span class="n">globstation</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[0-9][0-9][0-9][0-9]/</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">.[0-9][0-9].pos&quot;</span>
            <span class="n">stationfiles</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span> <span class="k">for</span> <span class="n">sf</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">globstation</span><span class="p">)]</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">F5Timeseries</span><span class="p">(</span><span class="n">stationfiles</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>
            <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">_location</span><span class="p">)</span>
            <span class="n">timeseries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_warnings</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">_id</span> <span class="o">!=</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files loaded for station ID &#39;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&#39; were named &#39;</span><span class="si">{</span><span class="n">ts</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
        <span class="c1"># done</span>
        <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">timeseries</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Tobias Khne.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>