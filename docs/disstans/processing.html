

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Processing &mdash; disstans 0.9 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Solvers" href="solvers.html" />
    <link rel="prev" title="Network" href="network.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> disstans
          

          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_1.html">Tutorial 1: The first synthetic station</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#building-a-model-collection">Building a Model collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#creating-timeseries-objects">Creating Timeseries objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#fitting-the-models">Fitting the models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_1.html#plotting-the-fit-and-residuals">Plotting the fit and residuals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_2.html">Tutorial 2: Advanced Models and Fitting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#creating-more-complex-synthetic-data">Creating more complex synthetic data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#spline-models-for-transients">Spline models for transients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#building-a-network">Building a Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#fitting-an-entire-network">Fitting an entire network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#advanced-plotting">Advanced plotting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#repeat-with-l2-regularization">Repeat with L2 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#repeat-with-l1-regularization">Repeat with L1 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#adding-reweighting-iterations">Adding reweighting iterations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_2.html#comparing-specific-parameters">Comparing specific parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_3.html">Tutorial 3: Incorporating Spatial Coherence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#preparations">Preparations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#dreaming-up-a-network">Dreaming up a network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#fantasizing-data">Fantasizing data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#removing-the-common-mode-error">Removing the Common Mode Error</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#fitting-the-data-using-reweighted-l1-regularization">Fitting the data using reweighted L1 regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#fitting-the-data-using-a-spatially-aware-l1-reweighting">Fitting the data using a spatially-aware L1 reweighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#finding-unmodeled-jumps">Finding unmodeled jumps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#statistics-of-spatial-reweighting">Statistics of spatial reweighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#model-parameter-correlations">Model parameter correlations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_3.html#transient-visualization-with-worm-plots">Transient visualization with worm plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/tutorial_4.html">Tutorial 4: The use and estimation of covariance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#making-a-noisy-network">Making a noisy network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#fitting-the-models-with-the-spatial-l0-solver">Fitting the models with the spatial L0 solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#quality-of-the-fits">Quality of the fits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#correlation-of-parameters">Correlation of parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#simple-linear-regression-with-restricted-spline-set">Simple linear regression with restricted spline set</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial_4.html#empirical-covariance-estimation">Empirical covariance estimation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/example_1.html">Example 1: Long Valley Caldera Transient Motions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../examples/example_1.html#preparations">Preparations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../examples/example_1.html#getting-data">Getting data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../examples/example_1.html#building-the-network">Building the network</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../examples/example_1.html#cleaning-the-timeseries">Cleaning the timeseries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../examples/example_1.html#outlier-and-cme-removal">Outlier and CME removal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../examples/example_1.html#first-pass-major-steps-and-noisy-periods">First pass: major steps and noisy periods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../examples/example_1.html#second-pass-minor-catalog-based-steps">Second pass: minor, catalog-based steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../examples/example_1.html#model-parameter-estimation">Model parameter estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/example_1.html#comparison-of-secular-velocities">Comparison of secular velocities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/example_1.html#final-considerations">Final considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../examples/example_1.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../disstans.html">disstans</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="compiled.html">Compiled</a><ul>
<li class="toctree-l3"><a class="reference internal" href="compiled.html#maskedmedfilt2d">maskedmedfilt2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiled.html#source-code">Source Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="earthquakes.html">Earthquakes</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#model-parent-class">Model (Parent Class)</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#model-collection">Model Collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#basic-models">Basic Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="models.html#arctangent">Arctangent</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#exponential">Exponential</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#logarithmic">Logarithmic</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#polynomial">Polynomial</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#step">Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#sinusoidal">Sinusoidal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="models.html#spline-models">Spline Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="models.html#bspline">BSpline</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#ispline">ISpline</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#splineset">SplineSet</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="network.html">Network</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unwrap-dict-and-ts">unwrap_dict_and_ts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clean">clean</a></li>
<li class="toctree-l4"><a class="reference internal" href="#common-mode">common_mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#median">median</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stepdetector">StepDetector</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="solvers.html">Solvers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="solvers.html#local-solver-functions">Local Solver Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#lasso-regression">lasso_regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#linear-regression">linear_regression</a></li>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#ridge-regression">ridge_regression</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="solvers.html#global-solver-classes">Global Solver Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#spatialsolver">SpatialSolver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="solvers.html#solution-object">Solution Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="solvers.html#reweighting-functions">Reweighting Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#reweightingfunction">ReweightingFunction</a></li>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#inversereweighting">InverseReweighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#inversesquaredreweighting">InverseSquaredReweighting</a></li>
<li class="toctree-l4"><a class="reference internal" href="solvers.html#logarithmicreweighting">LogarithmicReweighting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="station.html">Station</a></li>
<li class="toctree-l2"><a class="reference internal" href="timeseries.html">Timeseries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#timeseries-parent-class">Timeseries (Parent Class)</a></li>
<li class="toctree-l3"><a class="reference internal" href="timeseries.html#specialized-classes">Specialized Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#gipsytimeseries">GipsyTimeseries</a></li>
<li class="toctree-l4"><a class="reference internal" href="timeseries.html#unrtimeseries">UNRTimeseries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools.html#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools.html#parallelize">parallelize</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#tvec-to-numpycol">tvec_to_numpycol</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#create-powerlaw-noise">create_powerlaw_noise</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#parse-maintenance-table">parse_maintenance_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#weighted-median">weighted_median</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#download-unr-data">download_unr_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#parse-unr-steps">parse_unr_steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#get-cov-dims">get_cov_dims</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#make-cov-index-map">make_cov_index_map</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#get-cov-indices">get_cov_indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#full-cov-mat-to-columns">full_cov_mat_to_columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#block-permutation">block_permutation</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#cov2corr">cov2corr</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tools.html#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools.html#rinexdataholding">RINEXDataHolding</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#timedelta">Timedelta</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html#click">Click</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">disstans</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../disstans.html">disstans</a> &raquo;</li>
        
      <li>Processing</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/disstans/processing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-disstans.processing">
<span id="processing"></span><h1>Processing<a class="headerlink" href="#module-disstans.processing" title="Permalink to this headline">¶</a></h1>
<p>This module contains some processing functions that while not belonging
to a specific class, require them to already be loaded and disstans to
be initialized.</p>
<p>For general helper functions, see <a class="reference internal" href="tools.html#module-disstans.tools" title="disstans.tools"><code class="xref py py-mod docutils literal notranslate"><span class="pre">tools</span></code></a>.</p>
<div class="section" id="unwrap-dict-and-ts">
<h2>unwrap_dict_and_ts<a class="headerlink" href="#unwrap-dict-and-ts" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="disstans.processing.unwrap_dict_and_ts">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">disstans.processing.</span></span><span class="sig-name descname"><span class="pre">unwrap_dict_and_ts</span></span><a class="reference internal" href="../_modules/disstans/processing.html#unwrap_dict_and_ts"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.unwrap_dict_and_ts" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper decorator that aims at simplifying the coding of processing functions.
Ideally, a new function that doesn’t need to know if its input is a
<a class="reference internal" href="timeseries.html#disstans.timeseries.Timeseries" title="disstans.timeseries.Timeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timeseries</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/version/1.2.4/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a>,
<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a> or a dictionary containing them, should not need to reimplement
a check and conversion for all of these because they just represent a data
array of some form. So, by providing this function decorator, a wrapped function
only needs to be able to work for a single array (plus some optional keyword arguments).
The wrapping will extract the data of the input types and convert the returned
array from <code class="docutils literal notranslate"><span class="pre">func</span></code> into the original format.</p>
<p class="rubric">Example</p>
<p>A basic function of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">in_array</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">):</span>
    <span class="c1"># do some things</span>
    <span class="k">return</span> <span class="n">out_array</span>
</pre></div>
</div>
<p>that takes and returns a NumPy array can be wrapped as follows
to be able to also take and return all the other data forms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@unwrap_dict_and_ts</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">in_array</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">):</span>
    <span class="c1"># do some things</span>
    <span class="k">return</span> <span class="n">out_array</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="clean">
<h3>clean<a class="headerlink" href="#clean" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="disstans.processing.clean">
<span class="sig-prename descclassname"><span class="pre">disstans.processing.</span></span><span class="sig-name descname"><span class="pre">clean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">station</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_in</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clean_kw_args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_callable_args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#clean"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>Function operating on a single station’s timeseries to clean it from outliers,
and mask it out if the data is not good enough. The criteria are set by
<a class="reference internal" href="config.html#disstans.config.defaults" title="disstans.config.defaults"><code class="xref py py-attr docutils literal notranslate"><span class="pre">defaults</span></code></a> but can be overriden by providing <code class="docutils literal notranslate"><span class="pre">clean_kw_args</span></code>.
The criteria are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'min_obs'</span></code>: Minimum number of observations the timeseries has to contain.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'std_outlier'</span></code>: Classify as an outlier any observation that is this many
standard deviations away from the reference.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'std_thresh'</span></code>: After the removal of outliers, the maximum standard deviation
that the residual between reference and input timeseries is allowed to have.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'min_clean_obs'</span></code>: After the removal of outliers, the minimum number of
observations the timeseries has to contain.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>station</strong> (<a class="reference internal" href="station.html#disstans.station.Station" title="disstans.station.Station"><em>disstans.station.Station</em></a>) – Station to operate on.</p></li>
<li><p><strong>ts_in</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Description of the timeseries to clean.</p></li>
<li><p><strong>reference</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><a class="reference internal" href="timeseries.html#disstans.timeseries.Timeseries" title="disstans.timeseries.Timeseries"><em>disstans.timeseries.Timeseries</em></a><em>, </em><em>function</em>) – Reference timeseries.
If string, checks for a timeseries with that description in the <code class="docutils literal notranslate"><span class="pre">station</span></code>.
If a <a class="reference internal" href="timeseries.html#disstans.timeseries.Timeseries" title="disstans.timeseries.Timeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timeseries</span></code></a> instance, use it directly.
If a function, the reference timeseries will be calculated as
<code class="docutils literal notranslate"><span class="pre">t_ref</span> <span class="pre">=</span> <span class="pre">reference(ts_in,</span> <span class="pre">**reference_callable_args)</span></code>.</p></li>
<li><p><strong>ts_out</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>optional</em>) – If provided, duplicate <code class="docutils literal notranslate"><span class="pre">ts_in</span></code> to a new timeseries <code class="docutils literal notranslate"><span class="pre">ts_out</span></code>
and clean the copy (to preserve the raw timeseries).</p></li>
<li><p><strong>clean_kw_args</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a><em>, </em><em>optional</em>) – Override the default cleaning criteria in <a class="reference internal" href="config.html#disstans.config.defaults" title="disstans.config.defaults"><code class="xref py py-attr docutils literal notranslate"><span class="pre">defaults</span></code></a>,
see the explanations above.</p></li>
<li><p><strong>reference_callable_args</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">reference</span></code> is a function, <code class="docutils literal notranslate"><span class="pre">reference_callable_args</span></code> can be used
to pass additional keyword arguments to the former when calculating
the reference timeseries.</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>By default, this function operates <em>in-place</em>. If you don’t wish to overwrite
the raw input timeseries, specify <code class="docutils literal notranslate"><span class="pre">ts_out</span></code>.</p>
</div>
</dd></dl>

</div>
<div class="section" id="common-mode">
<h3>common_mode<a class="headerlink" href="#common-mode" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="disstans.processing.common_mode">
<span class="sig-prename descclassname"><span class="pre">disstans.processing.</span></span><span class="sig-name descname"><span class="pre">common_mode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#common_mode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.common_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the Common Mode Error (CME) with the given method.
The input array should already be a residual.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a>) – Input array of shape <span class="math notranslate nohighlight">\((\text{num_observations},\text{n_stations})\)</span>
(can contain NaNs).
Wrapped by <a class="reference internal" href="#disstans.processing.unwrap_dict_and_ts" title="disstans.processing.unwrap_dict_and_ts"><code class="xref py py-func docutils literal notranslate"><span class="pre">unwrap_dict_and_ts()</span></code></a> to also accept
<a class="reference internal" href="timeseries.html#disstans.timeseries.Timeseries" title="disstans.timeseries.Timeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timeseries</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/version/1.2.4/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> and
dictionaries of them as input.</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Method to use to decompose the array. Possible values are <code class="docutils literal notranslate"><span class="pre">'pca'</span></code> and <code class="docutils literal notranslate"><span class="pre">'ica'}.</span>
<span class="pre">``'pca'</span></code> uses <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">Principal Component Analysis</a> (motivated by <a class="reference internal" href="#dong06" id="id1"><span>[dong06]</span></a>), whereas
<code class="docutils literal notranslate"><span class="pre">'ica'</span></code> uses <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.FastICA.html">Independent Component Analysis</a> (motivated by <a class="reference internal" href="#huang12" id="id2"><span>[huang12]</span></a>).</p></li>
<li><p><strong>num_components</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Number of CME bases to estimate. Defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>plot</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code>, include not only the modeled CME, but also the components
themselves in space and time. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>model</strong> (<em>numpy.ndarray</em>) – Modeled CME of shape <span class="math notranslate nohighlight">\((\text{num_observations},\text{n_stations})\)</span>.</p></li>
<li><p><strong>temporal</strong> (<em>numpy.ndarray</em>) – (Only if <code class="docutils literal notranslate"><span class="pre">plot=True</span></code>.) CME in time of shape
<span class="math notranslate nohighlight">\((\text{num_observations},\text{num_components})\)</span>.</p></li>
<li><p><strong>spatial</strong> (<em>numpy.ndarray</em>) – (Only if <code class="docutils literal notranslate"><span class="pre">plot=True</span></code>.) CME in space of shape
<span class="math notranslate nohighlight">\((\text{num_components},\text{n_stations})\)</span>.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="dong06"><span class="brackets"><a class="fn-backref" href="#id1">dong06</a></span></dt>
<dd><p>Dong, D., Fang, P., Bock, Y., Webb, F., Prawirodirdjo, L.,
Kedar, S., &amp; Jamason, P. (2006). <em>Spatiotemporal filtering using principal component
analysis and Karhunen-Loeve expansion approaches for regional GPS network analysis</em>.
Journal of Geophysical Research: Solid Earth, 111(B3).
doi:<a class="reference external" href="https://doi.org/10.1029/2005JB003806">10.1029/2005JB003806</a>.</p>
</dd>
<dt class="label" id="huang12"><span class="brackets"><a class="fn-backref" href="#id2">huang12</a></span></dt>
<dd><p>Huang, D. W., Dai, W. J., &amp; Luo, F. X. (2012).
<em>ICA Spatiotemporal Filtering Method and Its Application in GPS Deformation Monitoring</em>.
Applied Mechanics and Materials, 204–208, 2806–2812.
doi:<a class="reference external" href="http://dx.doi.org/10.4028/www.scientific.net/AMM.204-208.2806">10.4028/www.scientific.net/AMM.204-208.2806</a>.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="median">
<h3>median<a class="headerlink" href="#median" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="disstans.processing.median">
<span class="sig-prename descclassname"><span class="pre">disstans.processing.</span></span><span class="sig-name descname"><span class="pre">median</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#median"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.median" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the median filter (ignoring NaNs) column-wise, either by calling
<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.nanmedian.html#numpy.nanmedian" title="(in NumPy v1.20)"><code class="xref py py-func docutils literal notranslate"><span class="pre">nanmedian()</span></code></a> iteratively or by using the precompiled Fortran
function <a class="reference internal" href="compiled.html#disstans.compiled.maskedmedfilt2d" title="disstans.compiled.maskedmedfilt2d"><code class="xref py py-func docutils literal notranslate"><span class="pre">maskedmedfilt2d()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>array</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a>) – 2D input array (can contain NaNs).
Wrapped by <a class="reference internal" href="#disstans.processing.unwrap_dict_and_ts" title="disstans.processing.unwrap_dict_and_ts"><code class="xref py py-func docutils literal notranslate"><span class="pre">unwrap_dict_and_ts()</span></code></a> to also accept
<a class="reference internal" href="timeseries.html#disstans.timeseries.Timeseries" title="disstans.timeseries.Timeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timeseries</span></code></a>, <a class="reference external" href="https://pandas.pydata.org/pandas-docs/version/1.2.4/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></a> and
dictionaries of them as input.</p></li>
<li><p><strong>kernel_size</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Kernel size (length of moving window to compute the median over).
Has to be an odd number.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>filtered</strong> – 2D filtered array (may still contain NaNs).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="stepdetector">
<h3>StepDetector<a class="headerlink" href="#stepdetector" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="disstans.processing.StepDetector">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">disstans.processing.</span></span><span class="sig-name descname"><span class="pre">StepDetector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kernel_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_size_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#StepDetector"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.StepDetector" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a step detector based on the Akaike Information Criterion (AIC).</p>
<p>A window is moved over the input data, and two linear models are fit in the
method <a class="reference internal" href="#disstans.processing.StepDetector.search" title="disstans.processing.StepDetector.search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">search()</span></code></a>: one containing only a linear polynomial, and one containing an
additional step in the middle of the window. Then, using the AIC, the relative
probabilities are calculated, and saved for each timestep.</p>
<p>In the final step, one can threshold these relative probabilities with the method
<a class="reference internal" href="#disstans.processing.StepDetector.steps" title="disstans.processing.StepDetector.steps"><code class="xref py py-meth docutils literal notranslate"><span class="pre">steps()</span></code></a>, and look for local maxima, which will correspond to probable steps.</p>
<p>If the class is constructed with <code class="docutils literal notranslate"><span class="pre">kernel_size</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> passed, it automatically
calls its method <a class="reference internal" href="#disstans.processing.StepDetector.search" title="disstans.processing.StepDetector.search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">search()</span></code></a>, otherwise, <a class="reference internal" href="#disstans.processing.StepDetector.search" title="disstans.processing.StepDetector.search"><code class="xref py py-meth docutils literal notranslate"><span class="pre">search()</span></code></a> needs to be called manually.
Running the method again with a different <code class="docutils literal notranslate"><span class="pre">kernel_size</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code> will overwrite
previous results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kernel_size</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Window size of the detector. Must be odd.</p></li>
<li><p><strong>kernel_size_min</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Minimum window size of the detector (for edges). Must be smaller than or equal
to <code class="docutils literal notranslate"><span class="pre">kernel_size</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>x</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a><em>, </em><em>optional</em>) – Input array of shape <span class="math notranslate nohighlight">\((\text{num_observations},)\)</span>.
Should not contain NaNs.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a><em>, </em><em>optional</em>) – Input array of shape <span class="math notranslate nohighlight">\((\text{num_observations}, \text{num_components})\)</span>.
Can contain NaNs.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.AIC_c">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">AIC_c</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#StepDetector.AIC_c"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.StepDetector.AIC_c" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the Akaike Information Criterion for small samples for Least Squares
regression results. Implementation is based on <a class="reference internal" href="#burnhamanderson02" id="id3"><span>[burnhamanderson02]</span></a> (ch. 2).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rss</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Residual sum of squares.</p></li>
<li><p><strong>n</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of samples.</p></li>
<li><p><strong>K</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Degrees of freedom. If the Least Squares model has <span class="math notranslate nohighlight">\(\text{num_parameters}\)</span>
parameters (including the mean), then the degrees of freedom are
<span class="math notranslate nohighlight">\(K = \text{num_parameters} + 1\)</span></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The Small Sample AIC for Least Squares <span class="math notranslate nohighlight">\(\text{AIC}_c\)</span>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)">float</a></p>
</dd>
</dl>
<p class="rubric">References</p>
<dl class="citation">
<dt class="label" id="burnhamanderson02"><span class="brackets"><a class="fn-backref" href="#id3">burnhamanderson02</a></span></dt>
<dd><p>(2002) <em>Information and Likelihood Theory:
A Basis for Model Selection and Inference.</em> In: Burnham K.P., Anderson D.R. (eds)
Model Selection and Multimodel Inference. Springer, New York, NY.
doi:<a class="reference external" href="https://doi.org/10.1007/978-0-387-22456-5_2">10.1007/978-0-387-22456-5_2</a>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.search">
<span class="sig-name descname"><span class="pre">search</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxdel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#StepDetector.search"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.StepDetector.search" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that will search for steps in the data.
Upon successful completion, it will return the relative step probabilities
as well as the residuals variances of the two hypotheses tested
(as reported by <a class="reference internal" href="#disstans.processing.StepDetector.test_single" title="disstans.processing.StepDetector.test_single"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_single()</span></code></a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a>) – Input array of shape <span class="math notranslate nohighlight">\((\text{num_observations},)\)</span>.
Should not contain NaNs.</p></li>
<li><p><strong>y</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a>) – Input array of shape <span class="math notranslate nohighlight">\((\text{num_observations}, \text{num_components})\)</span>.
Can contain NaNs.</p></li>
<li><p><strong>maxdel</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Difference in AIC that should be considered not significantly better.
(Refers to <span class="math notranslate nohighlight">\(\Delta_i = \text{AIC}_{c,i} - \text{AIC}_{c,\text{min}}\)</span>.)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>probabilities</strong> (<em>numpy.ndarray</em>) – Contains the relative probabilities array.
Has shape <span class="math notranslate nohighlight">\((\text{num_observations}, \text{num_components})\)</span>.</p></li>
<li><p><strong>var0</strong> (<em>numpy.ndarray</em>) – Contains the array of the residuals variance of the hypothesis
that no step is present.
Has shape <span class="math notranslate nohighlight">\((\text{num_observations}, \text{num_components})\)</span>.</p></li>
<li><p><strong>var1</strong> (<em>numpy.ndarray</em>) – Contains the array of the residuals variance of the hypothesis
that a step is present.
Has shape <span class="math notranslate nohighlight">\((\text{num_observations}, \text{num_components})\)</span>.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#disstans.processing.StepDetector.test_single" title="disstans.processing.StepDetector.test_single"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_single()</span></code></a></dt><dd><p>For more explanations about the return values.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.search_catalog">
<span class="sig-name descname"><span class="pre">search_catalog</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_description</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">catalog</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap_unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'D'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_nan_probs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#StepDetector.search_catalog"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.StepDetector.search_catalog" title="Permalink to this definition">¶</a></dt>
<dd><p>Search a dictionary of potential step times for each station in the dictionary
and assess the probability for each one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>net</strong> (<a class="reference internal" href="network.html#disstans.network.Network" title="disstans.network.Network"><em>disstans.network.Network</em></a>) – Network instance to operate on.</p></li>
<li><p><strong>ts_description</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – <a class="reference internal" href="timeseries.html#disstans.timeseries.Timeseries" title="disstans.timeseries.Timeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timeseries</span></code></a> description that will be analyzed.</p></li>
<li><p><strong>catalog</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a><em>, </em><a class="reference external" href="https://pandas.pydata.org/pandas-docs/version/1.2.4/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v1.2.4)"><em>pandas.DataFrame</em></a>) – Dictionary where each key is a station name and its value is a list of
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/version/1.2.4/reference/api/pandas.Timestamp.html#pandas.Timestamp" title="(in pandas v1.2.4)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timestamp</span></code></a> compatible potential times/dates.
Alternatively, a DataFrame with at least the columns <code class="docutils literal notranslate"><span class="pre">'station'</span></code> and <code class="docutils literal notranslate"><span class="pre">'time'</span></code>.</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Minimum <span class="math notranslate nohighlight">\(\Delta_i \geq 0\)</span> that needs to be satisfied in order to be a step.</p></li>
<li><p><strong>gap</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Maximum gap between identified steps to count as a continuous period
of possible steps.</p></li>
<li><p><strong>gap_unit</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>optional</em>) – Time unit of <code class="docutils literal notranslate"><span class="pre">gap</span></code>.</p></li>
<li><p><strong>keep_nan_probs</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – (Only applies to a DataFrame-type <code class="docutils literal notranslate"><span class="pre">catalog</span></code> input.)
If a catalogued station is not in the network, or if a catalogued timestamp
is after the available timeseries, no step probability can be calculated
and the results will contain NaNs.
If <code class="docutils literal notranslate"><span class="pre">True</span></code> (default), those entries will be kept in the output, and if
<code class="docutils literal notranslate"><span class="pre">False</span></code>, they will be dropped.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>step_table</strong> (<em>pandas.DataFrame</em>) – A DataFrame containing the columns <code class="docutils literal notranslate"><span class="pre">'station'</span></code> (its name), <code class="docutils literal notranslate"><span class="pre">'time'</span></code>
(a timestamp of the station) and <code class="docutils literal notranslate"><span class="pre">'probability'</span></code> (maximum <span class="math notranslate nohighlight">\(\Delta_i\)</span>
over all components for this timestamp) for each potential step in <code class="docutils literal notranslate"><span class="pre">catalog</span></code>,
as well as <code class="docutils literal notranslate"><span class="pre">var0</span></code> and <code class="docutils literal notranslate"><span class="pre">var1</span></code> (the two hypotheses’ residuals variances
for the component of maximum step probability).
If a DataFrame was passed as <code class="docutils literal notranslate"><span class="pre">catalog</span></code>, a copy of that will be returned, with
the added columns specified above.</p></li>
<li><p><strong>step_ranges</strong> (<em>list</em>) – A list of lists containing continuous periods over all stations of the potential
steps as determined by <code class="docutils literal notranslate"><span class="pre">gap</span></code> and <code class="docutils literal notranslate"><span class="pre">gap_unit</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.search_network">
<span class="sig-name descname"><span class="pre">search_network</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">net</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_description</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxdel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gap_unit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'D'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#StepDetector.search_network"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.StepDetector.search_network" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that searches for steps in an entire network (possibly in parallel),
thresholds those probabilities, and identifies all the consecutive ranges in which
steps happen over the network.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>net</strong> (<a class="reference internal" href="network.html#disstans.network.Network" title="disstans.network.Network"><em>disstans.network.Network</em></a>) – Network instance to operate on.</p></li>
<li><p><strong>ts_description</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – <a class="reference internal" href="timeseries.html#disstans.timeseries.Timeseries" title="disstans.timeseries.Timeseries"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timeseries</span></code></a> description that will be analyzed.</p></li>
<li><p><strong>maxdel</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Difference in AIC that should be considered not significantly better.
(Refers to <span class="math notranslate nohighlight">\(\Delta_i = \text{AIC}_{c,i} - \text{AIC}_{c,\text{min}}\)</span>.)</p></li>
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Minimum <span class="math notranslate nohighlight">\(\Delta_i \geq 0\)</span> that needs to be satisfied in order to be a step.</p></li>
<li><p><strong>gap</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Maximum gap between identified steps to count as a continuous period
of possible steps.</p></li>
<li><p><strong>gap_unit</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a><em>, </em><em>optional</em>) – Time unit of <code class="docutils literal notranslate"><span class="pre">gap</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>step_table</strong> (<em>pandas.DataFrame</em>) – A DataFrame containing the columns <code class="docutils literal notranslate"><span class="pre">'station'</span></code> (its name), <code class="docutils literal notranslate"><span class="pre">'time'</span></code>
(a timestamp of the station) and <code class="docutils literal notranslate"><span class="pre">'probability'</span></code> (maximum <span class="math notranslate nohighlight">\(\Delta_i\)</span>
over all components for this timestamp), as well as <code class="docutils literal notranslate"><span class="pre">var0</span></code>, <code class="docutils literal notranslate"><span class="pre">var1</span></code>
(the two hypotheses’ residuals variances for the component of
maximum step probability) and <code class="docutils literal notranslate"><span class="pre">varred</span></code> (the variance reduction in percent,
<code class="docutils literal notranslate"><span class="pre">(var0</span> <span class="pre">-</span> <span class="pre">var1)</span> <span class="pre">/</span> <span class="pre">var0</span></code>).</p></li>
<li><p><strong>step_ranges</strong> (<em>list</em>) – A list of lists containing continuous periods over all stations of the potential
steps as determined by <code class="docutils literal notranslate"><span class="pre">gap</span></code> and <code class="docutils literal notranslate"><span class="pre">gap_unit</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.steps">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">steps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">probabilities</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxsteps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">inf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#StepDetector.steps"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.StepDetector.steps" title="Permalink to this definition">¶</a></dt>
<dd><p>Threshold the probabilities to return a list of steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>threshold</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Minimum <span class="math notranslate nohighlight">\(\Delta_i \geq 0\)</span> that needs to be satisfied in order to be a step.</p></li>
<li><p><strong>maxsteps</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a><em>, </em><em>optional</em>) – Return at most <code class="docutils literal notranslate"><span class="pre">maxsteps</span></code> number of steps. Can be useful if a good value for
<code class="docutils literal notranslate"><span class="pre">threshold</span></code> has not been found yet.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em>, </em><em>optional</em>) – If <code class="docutils literal notranslate"><span class="pre">True</span></code> (default), print warnings when there will be a large number of
steps identified given the <code class="docutils literal notranslate"><span class="pre">threshold</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>steps</strong> – Returns a list of <a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a> arrays that contain the indices of steps
for each component.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.9/library/stdtypes.html#list" title="(in Python v3.9)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.test_single">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">test_single</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xwindow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ywindow</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxdel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/disstans/processing.html#StepDetector.test_single"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#disstans.processing.StepDetector.test_single" title="Permalink to this definition">¶</a></dt>
<dd><p>For a single window (of arbitrary, but odd length), perform the AIC hypothesis test
whether a step is likely present (H1) or not (H0) in the <code class="docutils literal notranslate"><span class="pre">y</span></code> data given
<code class="docutils literal notranslate"><span class="pre">x</span></code> coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xwindow</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a>) – Time array of shape <span class="math notranslate nohighlight">\((\text{num_window},)\)</span>.
Should not contain NaNs.</p></li>
<li><p><strong>ywindow</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a>) – Data array of shape <span class="math notranslate nohighlight">\((\text{num_window},)\)</span>.
Should not contain NaNs.</p></li>
<li><p><strong>valid</strong> (<a class="reference external" href="https://numpy.org/doc/1.20/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.20)"><em>numpy.ndarray</em></a><em>, </em><em>optional</em>) – Mask array of the data of shape <span class="math notranslate nohighlight">\((\text{num_window},)\)</span>,
with <code class="docutils literal notranslate"><span class="pre">1</span></code> where the <code class="docutils literal notranslate"><span class="pre">ywindow</span></code> is finite (not NaN or infinity).
If not passed to the function, it is calculated internally, which will slow
down the computation.</p></li>
<li><p><strong>maxdel</strong> (<a class="reference external" href="https://docs.python.org/3.9/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a><em>, </em><em>optional</em>) – Difference in AIC that should be considered not significantly better.
(Refers to <span class="math notranslate nohighlight">\(\Delta_i = \text{AIC}_{c,i} - \text{AIC}_{c,\text{min}}\)</span>.)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>int</em> – Best hypothesis (<code class="docutils literal notranslate"><span class="pre">0</span></code> for no step, <code class="docutils literal notranslate"><span class="pre">1</span></code> for step).</p></li>
<li><p><em>float</em> – If H1 is the best hypothesis (and suffices <code class="docutils literal notranslate"><span class="pre">maxdel</span></code>), its relative probability,
otherwise the relative probability of H0 (which therefore can be <code class="docutils literal notranslate"><span class="pre">0</span></code> if H0 is also
the best hypothesis in general).</p></li>
<li><p><em>tuple</em> – A 2-tuple of the two mean-squared residuals of the H0 and H1 hypotheses,
respectively. Assuming the test is unbiased, this is the residual’s variance.
Is <code class="docutils literal notranslate"><span class="pre">NaN</span></code> in an element if the least-squares model did not converge.</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#disstans.processing.StepDetector.AIC_c" title="disstans.processing.StepDetector.AIC_c"><code class="xref py py-obj docutils literal notranslate"><span class="pre">AIC_c</span></code></a></dt><dd><p>For more information about the AIC hypothesis test.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.kernel_size">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">kernel_size</span></span><a class="headerlink" href="#disstans.processing.StepDetector.kernel_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Kernel (window) size of the detector.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="disstans.processing.StepDetector.kernel_size_min">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">kernel_size_min</span></span><a class="headerlink" href="#disstans.processing.StepDetector.kernel_size_min" title="Permalink to this definition">¶</a></dt>
<dd><p>Minimum kernel (window) size of the detector.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="solvers.html" class="btn btn-neutral float-right" title="Solvers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="network.html" class="btn btn-neutral float-left" title="Network" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Tobias Köhne.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>